[0m22:31:30.721635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1181a0740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a523830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a86c9e0>]}


============================== 22:31:30.722976 | 24a0c643-42fe-4e48-8961-5c2e92e414a1 ==============================
[0m22:31:30.722976 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:31:30.723206 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'no_print': 'None', 'target_path': 'None', 'use_colors': 'True', 'fail_fast': 'False', 'log_path': '/Users/nairuiliu/build_lab2/logs', 'introspect': 'True', 'partial_parse': 'True', 'write_json': 'True', 'log_format': 'default', 'quiet': 'False', 'debug': 'False', 'warn_error': 'None', 'static_parser': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'printer_width': '80', 'invocation_command': 'dbt run', 'profiles_dir': '/Users/nairuiliu/.dbt', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'version_check': 'True'}
[0m22:31:31.537156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '24a0c643-42fe-4e48-8961-5c2e92e414a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f58d7c0>]}
[0m22:31:31.552671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '24a0c643-42fe-4e48-8961-5c2e92e414a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118b3e870>]}
[0m22:31:31.553084 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:31:31.562447 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:31:31.562821 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:31:31.562959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '24a0c643-42fe-4e48-8961-5c2e92e414a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f5ebe60>]}
[0m22:31:31.869244 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.build_lab2.output
[0m22:31:31.872597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '24a0c643-42fe-4e48-8961-5c2e92e414a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc15670>]}
[0m22:31:31.930807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '24a0c643-42fe-4e48-8961-5c2e92e414a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc5a060>]}
[0m22:31:31.931016 [info ] [MainThread]: Found 1 model, 2 sources, 459 macros
[0m22:31:31.931133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24a0c643-42fe-4e48-8961-5c2e92e414a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc14050>]}
[0m22:31:31.931716 [info ] [MainThread]: 
[0m22:31:31.931923 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:31:31.932290 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m22:31:31.936631 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m22:31:31.936741 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m22:31:31.936822 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:31:32.982849 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.046 seconds
[0m22:31:32.985420 [debug] [ThreadPool]: On list_dev: Close
[0m22:31:33.106792 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m22:31:33.117668 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m22:31:33.118060 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m22:31:33.118317 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:31:33.651608 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.533 seconds
[0m22:31:33.656522 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m22:31:33.797714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24a0c643-42fe-4e48-8961-5c2e92e414a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c362a0>]}
[0m22:31:33.798429 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:31:33.798746 [info ] [MainThread]: 
[0m22:31:33.802200 [debug] [Thread-1 (]: Began running node model.build_lab2.90dprice_all_symbols
[0m22:31:33.802790 [info ] [Thread-1 (]: 1 of 1 START sql view model analytics.90dprice_all_symbols ..................... [RUN]
[0m22:31:33.803228 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_lab2.90dprice_all_symbols)
[0m22:31:33.803528 [debug] [Thread-1 (]: Began compiling node model.build_lab2.90dprice_all_symbols
[0m22:31:33.810069 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.90dprice_all_symbols"
[0m22:31:33.810863 [debug] [Thread-1 (]: Began executing node model.build_lab2.90dprice_all_symbols
[0m22:31:33.828387 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.90dprice_all_symbols"
[0m22:31:33.828976 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.90dprice_all_symbols"
[0m22:31:33.829140 [debug] [Thread-1 (]: On model.build_lab2.90dprice_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.90dprice_all_symbols"} */
create or replace   view dev.analytics.90dprice_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m22:31:33.829284 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:34.488437 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85687-0004-2d6b-0001-86f30007a57e
[0m22:31:34.489108 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 1 at position 38 unexpected '.90'.
[0m22:31:34.489635 [debug] [Thread-1 (]: On model.build_lab2.90dprice_all_symbols: Close
[0m22:31:34.630439 [debug] [Thread-1 (]: Database Error in model 90dprice_all_symbols (models/input/90dprice_all_symbols.sql)
  001003 (42000): SQL compilation error:
  syntax error line 1 at position 38 unexpected '.90'.
  compiled code at target/run/build_lab2/models/input/90dprice_all_symbols.sql
[0m22:31:34.632588 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24a0c643-42fe-4e48-8961-5c2e92e414a1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a86e240>]}
[0m22:31:34.633422 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model analytics.90dprice_all_symbols ............ [[31mERROR[0m in 0.83s]
[0m22:31:34.634061 [debug] [Thread-1 (]: Finished running node model.build_lab2.90dprice_all_symbols
[0m22:31:34.636224 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:31:34.636553 [debug] [MainThread]: Connection 'model.build_lab2.90dprice_all_symbols' was properly closed.
[0m22:31:34.636800 [info ] [MainThread]: 
[0m22:31:34.637066 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.70 seconds (2.70s).
[0m22:31:34.637681 [debug] [MainThread]: Command end result
[0m22:31:34.659966 [info ] [MainThread]: 
[0m22:31:34.660274 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:31:34.660438 [info ] [MainThread]: 
[0m22:31:34.660645 [error] [MainThread]:   Database Error in model 90dprice_all_symbols (models/input/90dprice_all_symbols.sql)
  001003 (42000): SQL compilation error:
  syntax error line 1 at position 38 unexpected '.90'.
  compiled code at target/run/build_lab2/models/input/90dprice_all_symbols.sql
[0m22:31:34.660798 [info ] [MainThread]: 
[0m22:31:34.660972 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:31:34.663639 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.9741974, "process_user_time": 3.682447, "process_kernel_time": 0.402494, "process_mem_max_rss": "205684736", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:31:34.663949 [debug] [MainThread]: Command `dbt run` failed at 22:31:34.663898 after 3.97 seconds
[0m22:31:34.664169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd3cbf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118bdbda0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f244c80>]}
[0m22:31:34.664343 [debug] [MainThread]: Flushing usage events
[0m22:37:49.405937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e3cc20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c6cf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c6cce0>]}


============================== 22:37:49.407741 | 744b4058-3479-4bb0-89bc-b75e5008e5af ==============================
[0m22:37:49.407741 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:37:49.407974 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'printer_width': '80', 'log_path': '/Users/nairuiliu/build_lab2/logs', 'static_parser': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'fail_fast': 'False', 'log_format': 'default', 'use_experimental_parser': 'False', 'empty': 'False', 'invocation_command': 'dbt run', 'use_colors': 'True', 'introspect': 'True', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'debug': 'False', 'indirect_selection': 'eager', 'no_print': 'None', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'profiles_dir': '/Users/nairuiliu/.dbt'}
[0m22:37:50.187094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '744b4058-3479-4bb0-89bc-b75e5008e5af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fea2510>]}
[0m22:37:50.202805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '744b4058-3479-4bb0-89bc-b75e5008e5af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128325940>]}
[0m22:37:50.203183 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:37:50.211753 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:37:50.260418 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m22:37:50.260643 [debug] [MainThread]: Partial parsing: added file: build_lab2://models/input/price90days_all_symbols.sql
[0m22:37:50.260738 [debug] [MainThread]: Partial parsing: deleted file: build_lab2://models/input/90dprice_all_symbols.sql
[0m22:37:50.329450 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.build_lab2.output
[0m22:37:50.333377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '744b4058-3479-4bb0-89bc-b75e5008e5af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1283be420>]}
[0m22:37:50.362533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '744b4058-3479-4bb0-89bc-b75e5008e5af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1288687d0>]}
[0m22:37:50.362706 [info ] [MainThread]: Found 1 model, 2 sources, 459 macros
[0m22:37:50.362813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '744b4058-3479-4bb0-89bc-b75e5008e5af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1284460c0>]}
[0m22:37:50.363401 [info ] [MainThread]: 
[0m22:37:50.363606 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:37:50.363922 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m22:37:50.368402 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m22:37:50.368529 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m22:37:50.368618 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:37:50.992856 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.624 seconds
[0m22:37:50.995911 [debug] [ThreadPool]: On list_dev: Close
[0m22:37:51.133459 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m22:37:51.146880 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m22:37:51.147598 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m22:37:51.147975 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:37:51.628810 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.480 seconds
[0m22:37:51.633454 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m22:37:51.796752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '744b4058-3479-4bb0-89bc-b75e5008e5af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12876db20>]}
[0m22:37:51.797772 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:37:51.798135 [info ] [MainThread]: 
[0m22:37:51.801834 [debug] [Thread-1 (]: Began running node model.build_lab2.price90days_all_symbols
[0m22:37:51.802568 [info ] [Thread-1 (]: 1 of 1 START sql view model analytics.price90days_all_symbols .................. [RUN]
[0m22:37:51.803048 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_lab2.price90days_all_symbols)
[0m22:37:51.803403 [debug] [Thread-1 (]: Began compiling node model.build_lab2.price90days_all_symbols
[0m22:37:51.812175 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.price90days_all_symbols"
[0m22:37:51.812990 [debug] [Thread-1 (]: Began executing node model.build_lab2.price90days_all_symbols
[0m22:37:51.832724 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.price90days_all_symbols"
[0m22:37:51.833359 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.price90days_all_symbols"
[0m22:37:51.833544 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.price90days_all_symbols"} */
create or replace   view dev.analytics.price90days_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m22:37:51.833713 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:37:52.586868 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.753 seconds
[0m22:37:52.608126 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: Close
[0m22:37:52.725269 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '744b4058-3479-4bb0-89bc-b75e5008e5af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1282905f0>]}
[0m22:37:52.726453 [info ] [Thread-1 (]: 1 of 1 OK created sql view model analytics.price90days_all_symbols ............. [[32mSUCCESS 1[0m in 0.92s]
[0m22:37:52.727155 [debug] [Thread-1 (]: Finished running node model.build_lab2.price90days_all_symbols
[0m22:37:52.728627 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:37:52.728942 [debug] [MainThread]: Connection 'model.build_lab2.price90days_all_symbols' was properly closed.
[0m22:37:52.729239 [info ] [MainThread]: 
[0m22:37:52.729523 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.37 seconds (2.37s).
[0m22:37:52.730139 [debug] [MainThread]: Command end result
[0m22:37:52.752153 [info ] [MainThread]: 
[0m22:37:52.752478 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:37:52.752659 [info ] [MainThread]: 
[0m22:37:52.752833 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:37:52.755404 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.373714, "process_user_time": 3.366779, "process_kernel_time": 0.449799, "process_mem_max_rss": "208027648", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:37:52.755754 [debug] [MainThread]: Command `dbt run` succeeded at 22:37:52.755700 after 3.37 seconds
[0m22:37:52.755977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c0c4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060e8f80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072dbe90>]}
[0m22:37:52.756156 [debug] [MainThread]: Flushing usage events
[0m22:58:11.675965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10997cda0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108de3230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a370c20>]}


============================== 22:58:11.677382 | d1b8e6e6-c129-46a4-aadd-7e080c9f11d5 ==============================
[0m22:58:11.677382 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:58:11.677602 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'warn_error': 'None', 'target_path': 'None', 'fail_fast': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'quiet': 'False', 'log_path': '/Users/nairuiliu/build_lab2/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'printer_width': '80', 'introspect': 'True', 'log_cache_events': 'False', 'log_format': 'default', 'empty': 'False', 'profiles_dir': '/Users/nairuiliu/.dbt', 'partial_parse': 'True', 'debug': 'False', 'version_check': 'True', 'write_json': 'True'}
[0m22:58:12.464918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd1b8e6e6-c129-46a4-aadd-7e080c9f11d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f545640>]}
[0m22:58:12.480095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd1b8e6e6-c129-46a4-aadd-7e080c9f11d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f9b740>]}
[0m22:58:12.480506 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:58:12.491801 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:58:12.541304 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m22:58:12.541516 [debug] [MainThread]: Partial parsing: added file: build_lab2://models/output/stock_price_analysis.sql
[0m22:58:12.612924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd1b8e6e6-c129-46a4-aadd-7e080c9f11d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1368cab70>]}
[0m22:58:12.642742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd1b8e6e6-c129-46a4-aadd-7e080c9f11d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084950a0>]}
[0m22:58:12.642923 [info ] [MainThread]: Found 2 models, 2 sources, 459 macros
[0m22:58:12.643052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1b8e6e6-c129-46a4-aadd-7e080c9f11d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fff0830>]}
[0m22:58:12.643660 [info ] [MainThread]: 
[0m22:58:12.643860 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:58:12.645283 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m22:58:12.649513 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m22:58:12.649624 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m22:58:12.649704 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:58:13.170781 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.521 seconds
[0m22:58:13.173414 [debug] [ThreadPool]: On list_dev: Close
[0m22:58:13.308342 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m22:58:13.319197 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m22:58:13.319553 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m22:58:13.319788 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:58:13.890924 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.571 seconds
[0m22:58:13.894866 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m22:58:14.032838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd1b8e6e6-c129-46a4-aadd-7e080c9f11d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a60ad50>]}
[0m22:58:14.033719 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:58:14.034091 [info ] [MainThread]: 
[0m22:58:14.037730 [debug] [Thread-1 (]: Began running node model.build_lab2.price90days_all_symbols
[0m22:58:14.038370 [info ] [Thread-1 (]: 1 of 2 START sql view model analytics.price90days_all_symbols .................. [RUN]
[0m22:58:14.038836 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_lab2.price90days_all_symbols)
[0m22:58:14.039157 [debug] [Thread-1 (]: Began compiling node model.build_lab2.price90days_all_symbols
[0m22:58:14.047167 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.price90days_all_symbols"
[0m22:58:14.047957 [debug] [Thread-1 (]: Began executing node model.build_lab2.price90days_all_symbols
[0m22:58:14.067591 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.price90days_all_symbols"
[0m22:58:14.068198 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.price90days_all_symbols"
[0m22:58:14.068392 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.price90days_all_symbols"} */
create or replace   view dev.analytics.price90days_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m22:58:14.068564 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:58:14.748345 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.679 seconds
[0m22:58:14.773042 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: Close
[0m22:58:14.891920 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b8e6e6-c129-46a4-aadd-7e080c9f11d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094e1280>]}
[0m22:58:14.893014 [info ] [Thread-1 (]: 1 of 2 OK created sql view model analytics.price90days_all_symbols ............. [[32mSUCCESS 1[0m in 0.85s]
[0m22:58:14.893704 [debug] [Thread-1 (]: Finished running node model.build_lab2.price90days_all_symbols
[0m22:58:14.894734 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m22:58:14.895332 [info ] [Thread-1 (]: 2 of 2 START sql table model analytics.stock_price_analysis .................... [RUN]
[0m22:58:14.895909 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.price90days_all_symbols, now model.build_lab2.stock_price_analysis)
[0m22:58:14.896331 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m22:58:14.900266 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m22:58:14.901263 [debug] [Thread-1 (]: Began executing node model.build_lab2.stock_price_analysis
[0m22:58:14.919130 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.stock_price_analysis"
[0m22:58:14.921168 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.stock_price_analysis"
[0m22:58:14.921439 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.stock_price_analysis"} */
create or replace transient table dev.analytics.stock_price_analysis
         as
        (WITH staged_data AS (
    SELECT *
    FROM dev.analytics.price90days_all_symbols
),

-- 50-day Moving Average
moving_averages AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (
            PARTITION BY symbol 
            ORDER BY date 
            ROWS BETWEEN 49 PRECEDING AND CURRENT ROW
        ) AS ma_50
    FROM staged_data
),

-- 14-day RSI
price_changes AS (
    SELECT
        date,
        symbol,
        close,
        LAG(close) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        COALESCE(close - LAG(close) OVER (PARTITION BY symbol ORDER BY date), 0) AS price_change
    FROM staged_data
),
gains_and_losses AS (
    SELECT
        date,
        symbol,
        close,
        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,
        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss
    FROM price_changes
),
average_gain_loss AS (
    SELECT
        date,
        symbol,
        close,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM gains_and_losses
),
rsi_14_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0)))) AS rsi_14
    FROM average_gain_loss
    JOIN moving_averages USING (date, symbol, close)
),

-- 10-day Momentum
momentum_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        rsi_14,
        LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date) AS price_10_days_ago,
        ((close - LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date)) / 
        NULLIF(LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date), 0)) * 100 AS momentum_10
    FROM rsi_14_calculation
)

SELECT
    date,
    symbol,
    close,
    ma_50,
    rsi_14,
    momentum_10
FROM momentum_calculation
        );
[0m22:58:14.921691 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:58:16.481813 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.560 seconds
[0m22:58:16.486602 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: Close
[0m22:58:16.604764 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd1b8e6e6-c129-46a4-aadd-7e080c9f11d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136c6a2d0>]}
[0m22:58:16.606293 [info ] [Thread-1 (]: 2 of 2 OK created sql table model analytics.stock_price_analysis ............... [[32mSUCCESS 1[0m in 1.71s]
[0m22:58:16.607312 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m22:58:16.608695 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:58:16.609062 [debug] [MainThread]: Connection 'model.build_lab2.stock_price_analysis' was properly closed.
[0m22:58:16.609359 [info ] [MainThread]: 
[0m22:58:16.609660 [info ] [MainThread]: Finished running 1 view model, 1 table model in 0 hours 0 minutes and 3.97 seconds (3.97s).
[0m22:58:16.610398 [debug] [MainThread]: Command end result
[0m22:58:16.630132 [info ] [MainThread]: 
[0m22:58:16.630381 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:58:16.630528 [info ] [MainThread]: 
[0m22:58:16.630678 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m22:58:16.633017 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.9830236, "process_user_time": 3.498925, "process_kernel_time": 0.370534, "process_mem_max_rss": "209649664", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:58:16.633358 [debug] [MainThread]: Command `dbt run` succeeded at 22:58:16.633302 after 4.98 seconds
[0m22:58:16.633575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10997f290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109512300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fdb17f0>]}
[0m22:58:16.633746 [debug] [MainThread]: Flushing usage events
[0m23:19:37.903780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056c2690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107290e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107290bf0>]}


============================== 23:19:37.905293 | 7a9e91d6-ae5c-417c-82d8-4a2d41866966 ==============================
[0m23:19:37.905293 [info ] [MainThread]: Running with dbt=1.8.7
[0m23:19:37.905524 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'static_parser': 'True', 'debug': 'False', 'empty': 'None', 'profiles_dir': '/Users/nairuiliu/.dbt', 'use_colors': 'True', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'fail_fast': 'False', 'write_json': 'True', 'version_check': 'True', 'target_path': 'None', 'warn_error': 'None', 'indirect_selection': 'eager', 'quiet': 'False', 'introspect': 'True', 'invocation_command': 'dbt snapshot', 'log_format': 'default', 'log_path': '/Users/nairuiliu/build_lab2/logs'}
[0m23:19:38.691402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7a9e91d6-ae5c-417c-82d8-4a2d41866966', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c3267b0>]}
[0m23:19:38.706918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7a9e91d6-ae5c-417c-82d8-4a2d41866966', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eb8b500>]}
[0m23:19:38.707356 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m23:19:38.716740 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m23:19:38.765639 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:19:38.765839 [debug] [MainThread]: Partial parsing: added file: build_lab2://snapshots/snapshot_stock_price_analysis.sql
[0m23:19:38.815231 [error] [MainThread]: Encountered an error:
Parsing Error
  at path ['unique_key']: ['date', 'symbol'] is not valid under any of the given schemas
[0m23:19:38.817085 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 0.93856406, "process_user_time": 3.128124, "process_kernel_time": 0.331651, "process_mem_max_rss": "195657728", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:19:38.817335 [debug] [MainThread]: Command `dbt snapshot` failed at 23:19:38.817293 after 0.94 seconds
[0m23:19:38.817480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cbc230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ed96bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f00d1f0>]}
[0m23:19:38.817604 [debug] [MainThread]: Flushing usage events
[0m23:22:13.016881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10719ab10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089a7200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095acb00>]}


============================== 23:22:13.018397 | 7e5372f8-849c-4d6b-be3f-bb7abd99f5a4 ==============================
[0m23:22:13.018397 [info ] [MainThread]: Running with dbt=1.8.7
[0m23:22:13.018622 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'profiles_dir': '/Users/nairuiliu/.dbt', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'printer_width': '80', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'warn_error': 'None', 'debug': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'fail_fast': 'False', 'target_path': 'None', 'log_format': 'default', 'write_json': 'True', 'quiet': 'False', 'introspect': 'True', 'invocation_command': 'dbt snapshot', 'version_check': 'True', 'cache_selected_only': 'False', 'partial_parse': 'True', 'use_colors': 'True', 'log_path': '/Users/nairuiliu/build_lab2/logs'}
[0m23:22:13.637810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7e5372f8-849c-4d6b-be3f-bb7abd99f5a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f7a61b0>]}
[0m23:22:13.652922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7e5372f8-849c-4d6b-be3f-bb7abd99f5a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a38f410>]}
[0m23:22:13.653358 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m23:22:13.661949 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m23:22:13.709197 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:22:13.709410 [debug] [MainThread]: Partial parsing: added file: build_lab2://snapshots/snapshot_stock_price_analysis.sql
[0m23:22:13.792312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7e5372f8-849c-4d6b-be3f-bb7abd99f5a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f491010>]}
[0m23:22:13.826095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7e5372f8-849c-4d6b-be3f-bb7abd99f5a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f49c470>]}
[0m23:22:13.826266 [info ] [MainThread]: Found 2 models, 1 snapshot, 2 sources, 459 macros
[0m23:22:13.826380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7e5372f8-849c-4d6b-be3f-bb7abd99f5a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a7b12b0>]}
[0m23:22:13.826985 [info ] [MainThread]: 
[0m23:22:13.827186 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:22:13.827554 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m23:22:13.831772 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m23:22:13.831882 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m23:22:13.831964 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:22:14.368294 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.536 seconds
[0m23:22:14.370309 [debug] [ThreadPool]: On list_dev: Close
[0m23:22:14.493394 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m23:22:14.502334 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m23:22:14.502663 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m23:22:14.502883 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:22:14.940967 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.438 seconds
[0m23:22:14.945453 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m23:22:15.068359 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_analytics)
[0m23:22:15.072468 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m23:22:15.072870 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m23:22:15.073150 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:22:15.596523 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.523 seconds
[0m23:22:15.599758 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m23:22:15.736063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7e5372f8-849c-4d6b-be3f-bb7abd99f5a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107933bf0>]}
[0m23:22:15.737045 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:22:15.737402 [info ] [MainThread]: 
[0m23:22:15.741345 [debug] [Thread-1 (]: Began running node snapshot.build_lab2.snapshot_session_summary
[0m23:22:15.742000 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_session_summary ........................ [RUN]
[0m23:22:15.742420 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now snapshot.build_lab2.snapshot_session_summary)
[0m23:22:15.742731 [debug] [Thread-1 (]: Began compiling node snapshot.build_lab2.snapshot_session_summary
[0m23:22:15.751540 [debug] [Thread-1 (]: Began executing node snapshot.build_lab2.snapshot_session_summary
[0m23:22:15.783255 [debug] [Thread-1 (]: Using snowflake connection "snapshot.build_lab2.snapshot_session_summary"
[0m23:22:15.783465 [debug] [Thread-1 (]: On snapshot.build_lab2.snapshot_session_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "snapshot.build_lab2.snapshot_session_summary"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_SESSION_SUMMARY"
[0m23:22:15.783607 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:22:16.206730 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.423 seconds
[0m23:22:16.248511 [debug] [Thread-1 (]: Using snowflake connection "snapshot.build_lab2.snapshot_session_summary"
[0m23:22:16.248828 [debug] [Thread-1 (]: On snapshot.build_lab2.snapshot_session_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "snapshot.build_lab2.snapshot_session_summary"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_SESSION_SUMMARY__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.analytics.stock_price_analysis

    ),

    snapshotted_data as (

        select *, 
    
        symbol as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_SESSION_SUMMARY"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        symbol as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(symbol as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        symbol as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        symbol as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m23:22:16.407396 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b856ba-0004-2c67-0001-86f300079f06
[0m23:22:16.407713 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 8
invalid identifier 'SYMBOL'
[0m23:22:16.408063 [debug] [Thread-1 (]: On snapshot.build_lab2.snapshot_session_summary: Close
[0m23:22:16.532726 [debug] [Thread-1 (]: Database Error in snapshot snapshot_session_summary (snapshots/snapshot_stock_price_analysis.sql)
  000904 (42000): SQL compilation error: error line 17 at position 8
  invalid identifier 'SYMBOL'
[0m23:22:16.534875 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e5372f8-849c-4d6b-be3f-bb7abd99f5a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10893d400>]}
[0m23:22:16.535902 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_session_summary .................... [[31mERROR[0m in 0.79s]
[0m23:22:16.536523 [debug] [Thread-1 (]: Finished running node snapshot.build_lab2.snapshot_session_summary
[0m23:22:16.538663 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:22:16.538955 [debug] [MainThread]: Connection 'snapshot.build_lab2.snapshot_session_summary' was properly closed.
[0m23:22:16.539218 [info ] [MainThread]: 
[0m23:22:16.539512 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 2.71 seconds (2.71s).
[0m23:22:16.540091 [debug] [MainThread]: Command end result
[0m23:22:16.560746 [info ] [MainThread]: 
[0m23:22:16.561061 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:22:16.561221 [info ] [MainThread]: 
[0m23:22:16.561426 [error] [MainThread]:   Database Error in snapshot snapshot_session_summary (snapshots/snapshot_stock_price_analysis.sql)
  000904 (42000): SQL compilation error: error line 17 at position 8
  invalid identifier 'SYMBOL'
[0m23:22:16.561571 [info ] [MainThread]: 
[0m23:22:16.561741 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m23:22:16.564130 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 3.5700562, "process_user_time": 3.519693, "process_kernel_time": 0.357779, "process_mem_max_rss": "210927616", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:22:16.564466 [debug] [MainThread]: Command `dbt snapshot` failed at 23:22:16.564409 after 3.57 seconds
[0m23:22:16.564684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109548260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e82bd70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f76a0f0>]}
[0m23:22:16.564862 [debug] [MainThread]: Flushing usage events
[0m23:27:33.634209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123b38f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126acf20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126acce0>]}


============================== 23:27:33.635666 | 99973c4c-a0cd-4bb1-9a43-0b97fdf3adbf ==============================
[0m23:27:33.635666 [info ] [MainThread]: Running with dbt=1.8.7
[0m23:27:33.635913 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'static_parser': 'True', 'indirect_selection': 'eager', 'profiles_dir': '/Users/nairuiliu/.dbt', 'log_path': '/Users/nairuiliu/build_lab2/logs', 'warn_error': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'write_json': 'True', 'use_experimental_parser': 'False', 'log_format': 'default', 'target_path': 'None', 'debug': 'False', 'use_colors': 'True', 'empty': 'None', 'version_check': 'True', 'invocation_command': 'dbt test', 'cache_selected_only': 'False', 'introspect': 'True', 'quiet': 'False', 'no_print': 'None', 'printer_width': '80'}
[0m23:27:34.427142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '99973c4c-a0cd-4bb1-9a43-0b97fdf3adbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1305f1d60>]}
[0m23:27:34.442573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '99973c4c-a0cd-4bb1-9a43-0b97fdf3adbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1306b38c0>]}
[0m23:27:34.443011 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m23:27:34.454517 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m23:27:34.508565 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:27:34.508811 [debug] [MainThread]: Partial parsing: added file: build_lab2://models/schema.yml
[0m23:27:34.592187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '99973c4c-a0cd-4bb1-9a43-0b97fdf3adbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1521f3ec0>]}
[0m23:27:34.634759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '99973c4c-a0cd-4bb1-9a43-0b97fdf3adbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1523f6030>]}
[0m23:27:34.634949 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m23:27:34.635076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '99973c4c-a0cd-4bb1-9a43-0b97fdf3adbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1523a4230>]}
[0m23:27:34.635703 [info ] [MainThread]: 
[0m23:27:34.635929 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:27:34.637350 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_analytics'
[0m23:27:34.642352 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m23:27:34.642459 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m23:27:34.642541 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:27:35.129680 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.487 seconds
[0m23:27:35.134827 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m23:27:35.244826 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_analytics, now list_dev_snapshot)
[0m23:27:35.248602 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m23:27:35.248972 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m23:27:35.249231 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:27:35.765685 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.516 seconds
[0m23:27:35.769766 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m23:27:35.883209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '99973c4c-a0cd-4bb1-9a43-0b97fdf3adbf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1520d4050>]}
[0m23:27:35.883991 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:27:35.884322 [info ] [MainThread]: 
[0m23:27:35.887650 [debug] [Thread-1 (]: Began running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m23:27:35.888073 [info ] [Thread-1 (]: 1 of 1 START test not_null_stock_price_analysis_close .......................... [RUN]
[0m23:27:35.888440 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now test.build_lab2.not_null_stock_price_analysis_close.c1575213a5)
[0m23:27:35.888707 [debug] [Thread-1 (]: Began compiling node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m23:27:35.901363 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m23:27:35.901944 [debug] [Thread-1 (]: Began executing node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m23:27:35.913342 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m23:27:35.913852 [debug] [Thread-1 (]: Using snowflake connection "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m23:27:35.914022 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from dev.analytics.stock_price_analysis
where close is null



      
    ) dbt_internal_test
[0m23:27:35.914172 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:27:36.987623 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.073 seconds
[0m23:27:36.999720 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: Close
[0m23:27:37.177761 [info ] [Thread-1 (]: 1 of 1 PASS not_null_stock_price_analysis_close ................................ [[32mPASS[0m in 1.29s]
[0m23:27:37.178622 [debug] [Thread-1 (]: Finished running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m23:27:37.179846 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:27:37.180148 [debug] [MainThread]: Connection 'test.build_lab2.not_null_stock_price_analysis_close.c1575213a5' was properly closed.
[0m23:27:37.180405 [info ] [MainThread]: 
[0m23:27:37.180675 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.54 seconds (2.54s).
[0m23:27:37.181235 [debug] [MainThread]: Command end result
[0m23:27:37.201801 [info ] [MainThread]: 
[0m23:27:37.202062 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:27:37.202208 [info ] [MainThread]: 
[0m23:27:37.202352 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:27:37.204549 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.5966725, "process_user_time": 3.42549, "process_kernel_time": 0.363799, "process_mem_max_rss": "210681856", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:27:37.204826 [debug] [MainThread]: Command `dbt test` succeeded at 23:27:37.204776 after 3.60 seconds
[0m23:27:37.205006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126ad010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126acfb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126acf20>]}
[0m23:27:37.205164 [debug] [MainThread]: Flushing usage events
[0m23:31:21.047142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091440e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099acbf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099ac980>]}


============================== 23:31:21.048632 | 9a368456-1861-422b-a3ec-a35b05f70f20 ==============================
[0m23:31:21.048632 [info ] [MainThread]: Running with dbt=1.8.7
[0m23:31:21.048864 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/nairuiliu/Repositories/sjsu-data226/week8/airflow/build_lab2/logs', 'target_path': 'None', 'write_json': 'True', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'empty': 'None', 'version_check': 'True', 'static_parser': 'True', 'log_format': 'default', 'quiet': 'False', 'fail_fast': 'False', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'warn_error': 'None', 'introspect': 'True', 'invocation_command': 'dbt clean', 'use_colors': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'profiles_dir': '/Users/nairuiliu/.dbt'}
[0m23:31:21.088907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9a368456-1861-422b-a3ec-a35b05f70f20', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10945bef0>]}
[0m23:31:21.098964 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.07568279, "process_user_time": 0.446355, "process_kernel_time": 0.113183, "process_mem_max_rss": "107053056", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:31:21.099190 [debug] [MainThread]: Command `dbt clean` succeeded at 23:31:21.099152 after 0.08 seconds
[0m23:31:21.099315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a727e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109977590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099acc20>]}
[0m23:31:21.099428 [debug] [MainThread]: Flushing usage events
[0m22:49:56.525749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa92f41a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa97c4cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa97baa20>]}


============================== 22:49:56.528758 | d4a2a9d7-0d12-45bd-893f-64de5b832ab1 ==============================
[0m22:49:56.528758 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:49:56.529246 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:49:56.900307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd4a2a9d7-0d12-45bd-893f-64de5b832ab1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd00350>]}
[0m22:49:56.916935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd4a2a9d7-0d12-45bd-893f-64de5b832ab1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd10a40>]}
[0m22:49:56.917291 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:49:56.949998 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:49:56.950631 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:49:56.951003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd4a2a9d7-0d12-45bd-893f-64de5b832ab1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89144380>]}
[0m22:49:57.387279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd4a2a9d7-0d12-45bd-893f-64de5b832ab1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8355a780>]}
[0m22:49:57.457808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd4a2a9d7-0d12-45bd-893f-64de5b832ab1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83547530>]}
[0m22:49:57.458113 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m22:49:57.458501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4a2a9d7-0d12-45bd-893f-64de5b832ab1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8352a240>]}
[0m22:49:57.459252 [info ] [MainThread]: 
[0m22:49:57.459596 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:49:57.461222 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m22:49:57.465993 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m22:49:57.466195 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m22:49:57.466404 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:49:58.023312 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.557 seconds
[0m22:49:58.026388 [debug] [ThreadPool]: On list_dev: Close
[0m22:49:58.178804 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m22:49:58.190797 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m22:49:58.191495 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m22:49:58.191926 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:49:58.731909 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.540 seconds
[0m22:49:58.734932 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m22:49:58.845834 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_analytics)
[0m22:49:58.850349 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m22:49:58.850998 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m22:49:58.851522 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:49:59.399960 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.548 seconds
[0m22:49:59.403436 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m22:49:59.516377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd4a2a9d7-0d12-45bd-893f-64de5b832ab1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9453e30>]}
[0m22:49:59.517633 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:49:59.518951 [info ] [MainThread]: 
[0m22:49:59.533267 [debug] [Thread-1 (]: Began running node model.build_lab2.price90days_all_symbols
[0m22:49:59.534034 [info ] [Thread-1 (]: 1 of 2 START sql view model analytics.price90days_all_symbols .................. [RUN]
[0m22:49:59.535008 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_lab2.price90days_all_symbols)
[0m22:49:59.535477 [debug] [Thread-1 (]: Began compiling node model.build_lab2.price90days_all_symbols
[0m22:49:59.541736 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.price90days_all_symbols"
[0m22:49:59.544244 [debug] [Thread-1 (]: Began executing node model.build_lab2.price90days_all_symbols
[0m22:49:59.561385 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.price90days_all_symbols"
[0m22:49:59.563250 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.price90days_all_symbols"
[0m22:49:59.563549 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.price90days_all_symbols"} */
create or replace   view dev.analytics.price90days_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m22:49:59.563825 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:50:00.656531 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.092 seconds
[0m22:50:00.680531 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: Close
[0m22:50:00.788874 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4a2a9d7-0d12-45bd-893f-64de5b832ab1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa92f6d50>]}
[0m22:50:00.789743 [info ] [Thread-1 (]: 1 of 2 OK created sql view model analytics.price90days_all_symbols ............. [[32mSUCCESS 1[0m in 1.25s]
[0m22:50:00.790668 [debug] [Thread-1 (]: Finished running node model.build_lab2.price90days_all_symbols
[0m22:50:00.791664 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m22:50:00.792245 [info ] [Thread-1 (]: 2 of 2 START sql table model analytics.stock_price_analysis .................... [RUN]
[0m22:50:00.792884 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.price90days_all_symbols, now model.build_lab2.stock_price_analysis)
[0m22:50:00.793264 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m22:50:00.795663 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m22:50:00.797145 [debug] [Thread-1 (]: Began executing node model.build_lab2.stock_price_analysis
[0m22:50:00.809551 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.stock_price_analysis"
[0m22:50:00.811570 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.stock_price_analysis"
[0m22:50:00.811922 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.stock_price_analysis"} */
create or replace transient table dev.analytics.stock_price_analysis
         as
        (WITH staged_data AS (
    SELECT *
    FROM dev.analytics.price90days_all_symbols
),

-- 50-day Moving Average
moving_averages AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (
            PARTITION BY symbol 
            ORDER BY date 
            ROWS BETWEEN 49 PRECEDING AND CURRENT ROW
        ) AS ma_50
    FROM staged_data
),

-- 14-day RSI
price_changes AS (
    SELECT
        date,
        symbol,
        close,
        LAG(close) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        COALESCE(close - LAG(close) OVER (PARTITION BY symbol ORDER BY date), 0) AS price_change
    FROM staged_data
),
gains_and_losses AS (
    SELECT
        date,
        symbol,
        close,
        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,
        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss
    FROM price_changes
),
average_gain_loss AS (
    SELECT
        date,
        symbol,
        close,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM gains_and_losses
),
rsi_14_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0)))) AS rsi_14
    FROM average_gain_loss
    JOIN moving_averages USING (date, symbol, close)
),

-- 10-day Momentum
momentum_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        rsi_14,
        LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date) AS price_10_days_ago,
        ((close - LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date)) / 
        NULLIF(LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date), 0)) * 100 AS momentum_10
    FROM rsi_14_calculation
)

SELECT
    date,
    symbol,
    close,
    ma_50,
    rsi_14,
    momentum_10
FROM momentum_calculation
        );
[0m22:50:00.812276 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:50:03.014102 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.201 seconds
[0m22:50:03.018184 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: Close
[0m22:50:03.155039 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd4a2a9d7-0d12-45bd-893f-64de5b832ab1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff839a6a50>]}
[0m22:50:03.156247 [info ] [Thread-1 (]: 2 of 2 OK created sql table model analytics.stock_price_analysis ............... [[32mSUCCESS 1[0m in 2.36s]
[0m22:50:03.157546 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m22:50:03.159267 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:50:03.159664 [debug] [MainThread]: Connection 'model.build_lab2.stock_price_analysis' was properly closed.
[0m22:50:03.160040 [info ] [MainThread]: 
[0m22:50:03.160468 [info ] [MainThread]: Finished running 1 view model, 1 table model in 0 hours 0 minutes and 5.70 seconds (5.70s).
[0m22:50:03.161344 [debug] [MainThread]: Command end result
[0m22:50:03.186446 [info ] [MainThread]: 
[0m22:50:03.186897 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:50:03.187318 [info ] [MainThread]: 
[0m22:50:03.187592 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m22:50:03.188249 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.6796412, "process_user_time": 2.666341, "process_kernel_time": 0.192905, "process_mem_max_rss": "212436", "process_in_blocks": "16", "process_out_blocks": "4956"}
[0m22:50:03.188539 [debug] [MainThread]: Command `dbt run` succeeded at 22:50:03.188494 after 6.68 seconds
[0m22:50:03.188774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa8d0a3f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82df0ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa94c320>]}
[0m22:50:03.189038 [debug] [MainThread]: Flushing usage events
[0m22:50:05.458417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80561310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff805de6c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e076450>]}


============================== 22:50:05.461173 | 7291bbe2-bb01-4f67-9073-7a6275b83721 ==============================
[0m22:50:05.461173 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:50:05.461667 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:50:05.769141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7291bbe2-bb01-4f67-9073-7a6275b83721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ef80ce0>]}
[0m22:50:05.785277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7291bbe2-bb01-4f67-9073-7a6275b83721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c83d6d0>]}
[0m22:50:05.785610 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:50:05.816896 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:50:05.866385 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:50:05.866638 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:50:05.883811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7291bbe2-bb01-4f67-9073-7a6275b83721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c661040>]}
[0m22:50:05.927727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7291bbe2-bb01-4f67-9073-7a6275b83721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c04cc80>]}
[0m22:50:05.927984 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m22:50:05.928369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7291bbe2-bb01-4f67-9073-7a6275b83721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c1fe450>]}
[0m22:50:05.929001 [info ] [MainThread]: 
[0m22:50:05.929413 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:50:05.930981 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m22:50:05.937402 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m22:50:05.937605 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m22:50:05.937774 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:50:06.378125 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.440 seconds
[0m22:50:06.391244 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m22:50:06.532748 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_analytics)
[0m22:50:06.537465 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m22:50:06.538155 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m22:50:06.538641 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:50:07.005251 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.466 seconds
[0m22:50:07.008596 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m22:50:07.131304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7291bbe2-bb01-4f67-9073-7a6275b83721', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ed48ec0>]}
[0m22:50:07.132535 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:50:07.133946 [info ] [MainThread]: 
[0m22:50:07.145581 [debug] [Thread-1 (]: Began running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m22:50:07.146463 [info ] [Thread-1 (]: 1 of 1 START test not_null_stock_price_analysis_close .......................... [RUN]
[0m22:50:07.147492 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now test.build_lab2.not_null_stock_price_analysis_close.c1575213a5)
[0m22:50:07.148019 [debug] [Thread-1 (]: Began compiling node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m22:50:07.160428 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m22:50:07.161877 [debug] [Thread-1 (]: Began executing node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m22:50:07.172689 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m22:50:07.174006 [debug] [Thread-1 (]: Using snowflake connection "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m22:50:07.174296 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from dev.analytics.stock_price_analysis
where close is null



      
    ) dbt_internal_test
[0m22:50:07.174555 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:50:07.927636 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.753 seconds
[0m22:50:07.937155 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: Close
[0m22:50:08.087797 [info ] [Thread-1 (]: 1 of 1 PASS not_null_stock_price_analysis_close ................................ [[32mPASS[0m in 0.94s]
[0m22:50:08.089797 [debug] [Thread-1 (]: Finished running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m22:50:08.091803 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:50:08.092355 [debug] [MainThread]: Connection 'test.build_lab2.not_null_stock_price_analysis_close.c1575213a5' was properly closed.
[0m22:50:08.092858 [info ] [MainThread]: 
[0m22:50:08.093701 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.16 seconds (2.16s).
[0m22:50:08.094793 [debug] [MainThread]: Command end result
[0m22:50:08.126981 [info ] [MainThread]: 
[0m22:50:08.127616 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:50:08.127918 [info ] [MainThread]: 
[0m22:50:08.128208 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:50:08.128943 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.700741, "process_user_time": 2.079917, "process_kernel_time": 0.103945, "process_mem_max_rss": "209576", "process_out_blocks": "1835", "process_in_blocks": "0"}
[0m22:50:08.129279 [debug] [MainThread]: Command `dbt test` succeeded at 22:50:08.129227 after 2.70 seconds
[0m22:50:08.129524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ca6a3f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79f53890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5756eab0>]}
[0m22:50:08.129777 [debug] [MainThread]: Flushing usage events
[0m09:37:04.046719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9342f140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93a9f4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9342ef90>]}


============================== 09:37:04.050502 | e05944ad-c813-46f0-93bf-cb8d81e78f72 ==============================
[0m09:37:04.050502 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:37:04.051003 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:37:04.409734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e05944ad-c813-46f0-93bf-cb8d81e78f72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92ddbb90>]}
[0m09:37:04.426397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e05944ad-c813-46f0-93bf-cb8d81e78f72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9345e630>]}
[0m09:37:04.426783 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:37:04.462304 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:37:04.510997 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:37:04.511350 [debug] [MainThread]: Partial parsing: updated file: build_lab2://models/output/stock_price_analysis.sql
[0m09:37:04.627687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e05944ad-c813-46f0-93bf-cb8d81e78f72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff71b6f2f0>]}
[0m09:37:04.667539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e05944ad-c813-46f0-93bf-cb8d81e78f72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7177c800>]}
[0m09:37:04.667780 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m09:37:04.668119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e05944ad-c813-46f0-93bf-cb8d81e78f72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff717b05f0>]}
[0m09:37:04.668790 [info ] [MainThread]: 
[0m09:37:04.669096 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:37:04.670749 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m09:37:04.675386 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m09:37:04.675551 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m09:37:04.675678 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:37:05.186599 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.511 seconds
[0m09:37:05.187799 [debug] [ThreadPool]: On list_dev: Close
[0m09:37:05.327405 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m09:37:05.332339 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:37:05.332608 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:37:05.332836 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:37:05.713349 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.380 seconds
[0m09:37:05.714805 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:37:05.840136 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_analytics)
[0m09:37:05.844267 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:37:05.844969 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:37:05.845470 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:37:06.230109 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.385 seconds
[0m09:37:06.232296 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:37:06.347978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e05944ad-c813-46f0-93bf-cb8d81e78f72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff71b6d9d0>]}
[0m09:37:06.349234 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:37:06.350890 [info ] [MainThread]: 
[0m09:37:06.362683 [debug] [Thread-1 (]: Began running node model.build_lab2.price90days_all_symbols
[0m09:37:06.363495 [info ] [Thread-1 (]: 1 of 2 START sql view model analytics.price90days_all_symbols .................. [RUN]
[0m09:37:06.364472 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_lab2.price90days_all_symbols)
[0m09:37:06.364903 [debug] [Thread-1 (]: Began compiling node model.build_lab2.price90days_all_symbols
[0m09:37:06.371028 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.price90days_all_symbols"
[0m09:37:06.372744 [debug] [Thread-1 (]: Began executing node model.build_lab2.price90days_all_symbols
[0m09:37:06.389313 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.price90days_all_symbols"
[0m09:37:06.390472 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.price90days_all_symbols"
[0m09:37:06.390749 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.price90days_all_symbols"} */
create or replace   view dev.analytics.price90days_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m09:37:06.390961 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:37:07.183060 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.792 seconds
[0m09:37:07.204425 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: Close
[0m09:37:07.330696 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e05944ad-c813-46f0-93bf-cb8d81e78f72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff72244590>]}
[0m09:37:07.331653 [info ] [Thread-1 (]: 1 of 2 OK created sql view model analytics.price90days_all_symbols ............. [[32mSUCCESS 1[0m in 0.96s]
[0m09:37:07.332791 [debug] [Thread-1 (]: Finished running node model.build_lab2.price90days_all_symbols
[0m09:37:07.333847 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m09:37:07.334521 [info ] [Thread-1 (]: 2 of 2 START sql table model analytics.stock_price_analysis .................... [RUN]
[0m09:37:07.335202 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.price90days_all_symbols, now model.build_lab2.stock_price_analysis)
[0m09:37:07.335573 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m09:37:07.338088 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m09:37:07.339418 [debug] [Thread-1 (]: Began executing node model.build_lab2.stock_price_analysis
[0m09:37:07.353524 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.stock_price_analysis"
[0m09:37:07.355369 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.stock_price_analysis"
[0m09:37:07.355639 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.stock_price_analysis"} */
create or replace transient table dev.analytics.stock_price_analysis
         as
        (WITH staged_data AS (
    SELECT *
    FROM dev.analytics.price90days_all_symbols
),

-- 50-day Moving Average
moving_averages AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (
            PARTITION BY symbol 
            ORDER BY date 
            ROWS BETWEEN 49 PRECEDING AND CURRENT ROW
        ) AS ma_50
    FROM staged_data
),

-- 14-day RSI
price_changes AS (
    SELECT
        date,
        symbol,
        close,
        LAG(close) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        COALESCE(close - LAG(close) OVER (PARTITION BY symbol ORDER BY date), 0) AS price_change
    FROM staged_data
),
gains_and_losses AS (
    SELECT
        date,
        symbol,
        close,
        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,
        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss
    FROM price_changes
),
average_gain_loss AS (
    SELECT
        date,
        symbol,
        close,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM gains_and_losses
),
rsi_14_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0)))) AS rsi_14
    FROM average_gain_loss
    JOIN moving_averages USING (date, symbol, close)
),

-- 10-day Momentum
momentum_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        rsi_14,
        LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date) AS price_10_days_ago,
        ((close - LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date)) / 
        NULLIF(LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date), 0)) * 100 AS momentum_10
    FROM rsi_14_calculation
)

SELECT
    date,
    symbol,
    close,
    ma_50,
    rsi_14,
    momentum_10
FROM momentum_calculation

ALTER TABLE stock_price_analysis
ADD PRIMARY KEY (date);
[0m09:37:07.355880 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:37:07.877704 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85ce1-0004-2e68-0001-86f30007f976
[0m09:37:07.878763 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 84 at position 0 unexpected 'ALTER'.
[0m09:37:07.879557 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: Close
[0m09:37:08.013004 [debug] [Thread-1 (]: Database Error in model stock_price_analysis (models/output/stock_price_analysis.sql)
  001003 (42000): SQL compilation error:
  syntax error line 84 at position 0 unexpected 'ALTER'.
  compiled code at target/run/build_lab2/models/output/stock_price_analysis.sql
[0m09:37:08.014385 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e05944ad-c813-46f0-93bf-cb8d81e78f72', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff70b9fb30>]}
[0m09:37:08.015435 [error] [Thread-1 (]: 2 of 2 ERROR creating sql table model analytics.stock_price_analysis ........... [[31mERROR[0m in 0.68s]
[0m09:37:08.016887 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m09:37:08.019724 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:37:08.020316 [debug] [MainThread]: Connection 'model.build_lab2.stock_price_analysis' was properly closed.
[0m09:37:08.021022 [info ] [MainThread]: 
[0m09:37:08.021887 [info ] [MainThread]: Finished running 1 view model, 1 table model in 0 hours 0 minutes and 3.35 seconds (3.35s).
[0m09:37:08.023030 [debug] [MainThread]: Command end result
[0m09:37:08.050218 [info ] [MainThread]: 
[0m09:37:08.050802 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:37:08.051063 [info ] [MainThread]: 
[0m09:37:08.051493 [error] [MainThread]:   Database Error in model stock_price_analysis (models/output/stock_price_analysis.sql)
  001003 (42000): SQL compilation error:
  syntax error line 84 at position 0 unexpected 'ALTER'.
  compiled code at target/run/build_lab2/models/output/stock_price_analysis.sql
[0m09:37:08.051850 [info ] [MainThread]: 
[0m09:37:08.052119 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m09:37:08.052777 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.035944, "process_user_time": 2.278144, "process_kernel_time": 0.214615, "process_mem_max_rss": "213560", "process_in_blocks": "440", "process_out_blocks": "2776", "command_success": false}
[0m09:37:08.053087 [debug] [MainThread]: Command `dbt run` failed at 09:37:08.053037 after 4.04 seconds
[0m09:37:08.053342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93a9f4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff960a5700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff938d9f40>]}
[0m09:37:08.053601 [debug] [MainThread]: Flushing usage events
[0m09:38:17.688800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b413c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b4119d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9bfb8d40>]}


============================== 09:38:17.691656 | 6b0e9af3-376d-45d5-9911-a5870a700353 ==============================
[0m09:38:17.691656 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:38:17.692095 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m09:38:17.999578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6b0e9af3-376d-45d5-9911-a5870a700353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79dacad0>]}
[0m09:38:18.015276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6b0e9af3-376d-45d5-9911-a5870a700353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9aeeba40>]}
[0m09:38:18.015603 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:38:18.046765 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:38:18.092643 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:38:18.092956 [debug] [MainThread]: Partial parsing: updated file: build_lab2://models/output/stock_price_analysis.sql
[0m09:38:18.209135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6b0e9af3-376d-45d5-9911-a5870a700353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff795f9b80>]}
[0m09:38:18.251613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6b0e9af3-376d-45d5-9911-a5870a700353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79599700>]}
[0m09:38:18.251906 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m09:38:18.252238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b0e9af3-376d-45d5-9911-a5870a700353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79c03680>]}
[0m09:38:18.252896 [info ] [MainThread]: 
[0m09:38:18.253202 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:38:18.254853 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m09:38:18.260049 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m09:38:18.260343 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m09:38:18.260551 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:38:18.718522 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.458 seconds
[0m09:38:18.721510 [debug] [ThreadPool]: On list_dev: Close
[0m09:38:18.872082 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m09:38:18.882083 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:38:18.882628 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:38:18.883001 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:38:19.300632 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.417 seconds
[0m09:38:19.304358 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:38:19.421107 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_analytics, now list_dev_snapshot)
[0m09:38:19.425939 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:38:19.427708 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:38:19.428754 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:38:19.832245 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.403 seconds
[0m09:38:19.835218 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:38:19.947333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b0e9af3-376d-45d5-9911-a5870a700353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff797fc1d0>]}
[0m09:38:19.948575 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:38:19.949803 [info ] [MainThread]: 
[0m09:38:19.961258 [debug] [Thread-1 (]: Began running node model.build_lab2.price90days_all_symbols
[0m09:38:19.961952 [info ] [Thread-1 (]: 1 of 2 START sql view model analytics.price90days_all_symbols .................. [RUN]
[0m09:38:19.962753 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.build_lab2.price90days_all_symbols)
[0m09:38:19.963127 [debug] [Thread-1 (]: Began compiling node model.build_lab2.price90days_all_symbols
[0m09:38:19.968907 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.price90days_all_symbols"
[0m09:38:19.970048 [debug] [Thread-1 (]: Began executing node model.build_lab2.price90days_all_symbols
[0m09:38:19.985886 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.price90days_all_symbols"
[0m09:38:19.986740 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.price90days_all_symbols"
[0m09:38:19.987015 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.price90days_all_symbols"} */
create or replace   view dev.analytics.price90days_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m09:38:19.987281 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:38:20.606839 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.619 seconds
[0m09:38:20.631558 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: Close
[0m09:38:20.748404 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b0e9af3-376d-45d5-9911-a5870a700353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79dac5c0>]}
[0m09:38:20.749926 [info ] [Thread-1 (]: 1 of 2 OK created sql view model analytics.price90days_all_symbols ............. [[32mSUCCESS 1[0m in 0.78s]
[0m09:38:20.751691 [debug] [Thread-1 (]: Finished running node model.build_lab2.price90days_all_symbols
[0m09:38:20.753140 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m09:38:20.754177 [info ] [Thread-1 (]: 2 of 2 START sql table model analytics.stock_price_analysis .................... [RUN]
[0m09:38:20.755207 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.price90days_all_symbols, now model.build_lab2.stock_price_analysis)
[0m09:38:20.755754 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m09:38:20.759325 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m09:38:20.761310 [debug] [Thread-1 (]: Began executing node model.build_lab2.stock_price_analysis
[0m09:38:20.778924 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.stock_price_analysis"
[0m09:38:20.781291 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.stock_price_analysis"
[0m09:38:20.781694 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.stock_price_analysis"} */
create or replace transient table dev.analytics.stock_price_analysis
         as
        (WITH staged_data AS (
    SELECT *
    FROM dev.analytics.price90days_all_symbols
),

-- 50-day Moving Average
moving_averages AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (
            PARTITION BY symbol 
            ORDER BY date 
            ROWS BETWEEN 49 PRECEDING AND CURRENT ROW
        ) AS ma_50
    FROM staged_data
),

-- 14-day RSI
price_changes AS (
    SELECT
        date,
        symbol,
        close,
        LAG(close) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        COALESCE(close - LAG(close) OVER (PARTITION BY symbol ORDER BY date), 0) AS price_change
    FROM staged_data
),
gains_and_losses AS (
    SELECT
        date,
        symbol,
        close,
        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,
        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss
    FROM price_changes
),
average_gain_loss AS (
    SELECT
        date,
        symbol,
        close,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM gains_and_losses
),
rsi_14_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0)))) AS rsi_14
    FROM average_gain_loss
    JOIN moving_averages USING (date, symbol, close)
),

-- 10-day Momentum
momentum_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        rsi_14,
        LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date) AS price_10_days_ago,
        ((close - LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date)) / 
        NULLIF(LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date), 0)) * 100 AS momentum_10
    FROM rsi_14_calculation
)

SELECT
    date,
    symbol,
    close,
    ma_50,
    rsi_14,
    momentum_10
FROM momentum_calculation;
[0m09:38:20.782085 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:38:21.192960 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85ce2-0004-2f56-0001-86f3000804ba
[0m09:38:21.194058 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 82 at position 25 unexpected ';'.
[0m09:38:21.195187 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: Close
[0m09:38:21.337604 [debug] [Thread-1 (]: Database Error in model stock_price_analysis (models/output/stock_price_analysis.sql)
  001003 (42000): SQL compilation error:
  syntax error line 82 at position 25 unexpected ';'.
  compiled code at target/run/build_lab2/models/output/stock_price_analysis.sql
[0m09:38:21.338375 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b0e9af3-376d-45d5-9911-a5870a700353', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff78d9d1f0>]}
[0m09:38:21.339072 [error] [Thread-1 (]: 2 of 2 ERROR creating sql table model analytics.stock_price_analysis ........... [[31mERROR[0m in 0.58s]
[0m09:38:21.339984 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m09:38:21.341891 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:38:21.342330 [debug] [MainThread]: Connection 'model.build_lab2.stock_price_analysis' was properly closed.
[0m09:38:21.342714 [info ] [MainThread]: 
[0m09:38:21.343168 [info ] [MainThread]: Finished running 1 view model, 1 table model in 0 hours 0 minutes and 3.09 seconds (3.09s).
[0m09:38:21.343983 [debug] [MainThread]: Command end result
[0m09:38:21.366676 [info ] [MainThread]: 
[0m09:38:21.367093 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:38:21.367396 [info ] [MainThread]: 
[0m09:38:21.367687 [error] [MainThread]:   Database Error in model stock_price_analysis (models/output/stock_price_analysis.sql)
  001003 (42000): SQL compilation error:
  syntax error line 82 at position 25 unexpected ';'.
  compiled code at target/run/build_lab2/models/output/stock_price_analysis.sql
[0m09:38:21.367911 [info ] [MainThread]: 
[0m09:38:21.368126 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m09:38:21.368651 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.7099967, "process_user_time": 2.305701, "process_kernel_time": 0.116984, "process_mem_max_rss": "213416", "process_out_blocks": "2776", "command_success": false, "process_in_blocks": "0"}
[0m09:38:21.368974 [debug] [MainThread]: Command `dbt run` failed at 09:38:21.368902 after 3.71 seconds
[0m09:38:21.369227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f09a0c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ab03800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff78db8650>]}
[0m09:38:21.369451 [debug] [MainThread]: Flushing usage events
[0m09:39:21.084259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8352c4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83c3c770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82db2270>]}


============================== 09:39:21.087191 | 15121864-1fa8-487a-b3bc-15f5c0098471 ==============================
[0m09:39:21.087191 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:39:21.087620 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:39:21.437477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '15121864-1fa8-487a-b3bc-15f5c0098471', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff64578ce0>]}
[0m09:39:21.453559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '15121864-1fa8-487a-b3bc-15f5c0098471', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6240f260>]}
[0m09:39:21.453930 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:39:21.495495 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:39:21.544503 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:39:21.544851 [debug] [MainThread]: Partial parsing: updated file: build_lab2://models/output/stock_price_analysis.sql
[0m09:39:21.668521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '15121864-1fa8-487a-b3bc-15f5c0098471', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61716d80>]}
[0m09:39:21.708380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '15121864-1fa8-487a-b3bc-15f5c0098471', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6176eff0>]}
[0m09:39:21.708631 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m09:39:21.708965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15121864-1fa8-487a-b3bc-15f5c0098471', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61730710>]}
[0m09:39:21.709638 [info ] [MainThread]: 
[0m09:39:21.709957 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:39:21.711579 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m09:39:21.719699 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m09:39:21.719890 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m09:39:21.720023 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:39:22.193970 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.474 seconds
[0m09:39:22.197351 [debug] [ThreadPool]: On list_dev: Close
[0m09:39:22.337053 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m09:39:22.348080 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:39:22.348564 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:39:22.349001 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:39:22.827025 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.478 seconds
[0m09:39:22.830743 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:39:22.948505 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_analytics, now list_dev_snapshot)
[0m09:39:22.953753 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:39:22.954656 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:39:22.955295 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:39:23.366882 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.411 seconds
[0m09:39:23.369736 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:39:23.480607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '15121864-1fa8-487a-b3bc-15f5c0098471', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61730710>]}
[0m09:39:23.482038 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:39:23.483525 [info ] [MainThread]: 
[0m09:39:23.496831 [debug] [Thread-1 (]: Began running node model.build_lab2.price90days_all_symbols
[0m09:39:23.497647 [info ] [Thread-1 (]: 1 of 2 START sql view model analytics.price90days_all_symbols .................. [RUN]
[0m09:39:23.498715 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.build_lab2.price90days_all_symbols)
[0m09:39:23.499256 [debug] [Thread-1 (]: Began compiling node model.build_lab2.price90days_all_symbols
[0m09:39:23.505472 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.price90days_all_symbols"
[0m09:39:23.506656 [debug] [Thread-1 (]: Began executing node model.build_lab2.price90days_all_symbols
[0m09:39:23.522997 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.price90days_all_symbols"
[0m09:39:23.523892 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.price90days_all_symbols"
[0m09:39:23.524152 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.price90days_all_symbols"} */
create or replace   view dev.analytics.price90days_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m09:39:23.524397 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:39:24.068653 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.544 seconds
[0m09:39:24.085918 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: Close
[0m09:39:24.199659 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15121864-1fa8-487a-b3bc-15f5c0098471', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61e409e0>]}
[0m09:39:24.201158 [info ] [Thread-1 (]: 1 of 2 OK created sql view model analytics.price90days_all_symbols ............. [[32mSUCCESS 1[0m in 0.70s]
[0m09:39:24.203011 [debug] [Thread-1 (]: Finished running node model.build_lab2.price90days_all_symbols
[0m09:39:24.204920 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m09:39:24.205910 [info ] [Thread-1 (]: 2 of 2 START sql table model analytics.stock_price_analysis .................... [RUN]
[0m09:39:24.207103 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.price90days_all_symbols, now model.build_lab2.stock_price_analysis)
[0m09:39:24.207835 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m09:39:24.211854 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m09:39:24.213621 [debug] [Thread-1 (]: Began executing node model.build_lab2.stock_price_analysis
[0m09:39:24.231003 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.stock_price_analysis"
[0m09:39:24.232938 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.stock_price_analysis"
[0m09:39:24.233267 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.stock_price_analysis"} */
create or replace transient table dev.analytics.stock_price_analysis
         as
        (WITH staged_data AS (
    SELECT *
    FROM dev.analytics.price90days_all_symbols
),

-- 50-day Moving Average
moving_averages AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (
            PARTITION BY symbol 
            ORDER BY date 
            ROWS BETWEEN 49 PRECEDING AND CURRENT ROW
        ) AS ma_50
    FROM staged_data
),

-- 14-day RSI
price_changes AS (
    SELECT
        date,
        symbol,
        close,
        LAG(close) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        COALESCE(close - LAG(close) OVER (PARTITION BY symbol ORDER BY date), 0) AS price_change
    FROM staged_data
),
gains_and_losses AS (
    SELECT
        date,
        symbol,
        close,
        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,
        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss
    FROM price_changes
),
average_gain_loss AS (
    SELECT
        date,
        symbol,
        close,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM gains_and_losses
),
rsi_14_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0)))) AS rsi_14
    FROM average_gain_loss
    JOIN moving_averages USING (date, symbol, close)
),

-- 10-day Momentum
momentum_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        rsi_14,
        LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date) AS price_10_days_ago,
        ((close - LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date)) / 
        NULLIF(LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date), 0)) * 100 AS momentum_10
    FROM rsi_14_calculation
)

SELECT
    date,
    symbol,
    close,
    ma_50,
    rsi_14,
    momentum_10,
    primary key(date)
FROM momentum_calculation
        );
[0m09:39:24.233552 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:39:24.556103 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85ce3-0004-2e68-0001-86f30007f98e
[0m09:39:24.557193 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 82 at position 15 unexpected '('.
[0m09:39:24.558017 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: Close
[0m09:39:24.674650 [debug] [Thread-1 (]: Database Error in model stock_price_analysis (models/output/stock_price_analysis.sql)
  001003 (42000): SQL compilation error:
  syntax error line 82 at position 15 unexpected '('.
  compiled code at target/run/build_lab2/models/output/stock_price_analysis.sql
[0m09:39:24.676025 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '15121864-1fa8-487a-b3bc-15f5c0098471', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff60b94410>]}
[0m09:39:24.677164 [error] [Thread-1 (]: 2 of 2 ERROR creating sql table model analytics.stock_price_analysis ........... [[31mERROR[0m in 0.47s]
[0m09:39:24.678877 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m09:39:24.681717 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:39:24.682328 [debug] [MainThread]: Connection 'model.build_lab2.stock_price_analysis' was properly closed.
[0m09:39:24.682741 [info ] [MainThread]: 
[0m09:39:24.683522 [info ] [MainThread]: Finished running 1 view model, 1 table model in 0 hours 0 minutes and 2.97 seconds (2.97s).
[0m09:39:24.684527 [debug] [MainThread]: Command end result
[0m09:39:24.712825 [info ] [MainThread]: 
[0m09:39:24.713399 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:39:24.713651 [info ] [MainThread]: 
[0m09:39:24.713947 [error] [MainThread]:   Database Error in model stock_price_analysis (models/output/stock_price_analysis.sql)
  001003 (42000): SQL compilation error:
  syntax error line 82 at position 15 unexpected '('.
  compiled code at target/run/build_lab2/models/output/stock_price_analysis.sql
[0m09:39:24.714264 [info ] [MainThread]: 
[0m09:39:24.714496 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m09:39:24.715114 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.660982, "process_user_time": 2.298983, "process_kernel_time": 0.171222, "process_mem_max_rss": "213692", "process_in_blocks": "32", "process_out_blocks": "2776", "command_success": false}
[0m09:39:24.715422 [debug] [MainThread]: Command `dbt run` failed at 09:39:24.715371 after 3.66 seconds
[0m09:39:24.715710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85bb1490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8352c4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82db2180>]}
[0m09:39:24.716025 [debug] [MainThread]: Flushing usage events
[0m09:42:31.097056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5bdbe00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5bd9f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5c05d00>]}


============================== 09:42:31.100082 | 958f9588-39de-4023-ab90-54de4f0a102a ==============================
[0m09:42:31.100082 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:42:31.100544 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m09:42:31.424869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '958f9588-39de-4023-ab90-54de4f0a102a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87378ce0>]}
[0m09:42:31.443648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '958f9588-39de-4023-ab90-54de4f0a102a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff859659a0>]}
[0m09:42:31.444028 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:42:31.486087 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:42:31.538622 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:42:31.538988 [debug] [MainThread]: Partial parsing: updated file: build_lab2://models/output/stock_price_analysis.sql
[0m09:42:31.660722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '958f9588-39de-4023-ab90-54de4f0a102a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff846567b0>]}
[0m09:42:31.702865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '958f9588-39de-4023-ab90-54de4f0a102a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84285640>]}
[0m09:42:31.703120 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m09:42:31.703499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '958f9588-39de-4023-ab90-54de4f0a102a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84321bb0>]}
[0m09:42:31.704193 [info ] [MainThread]: 
[0m09:42:31.704516 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:42:31.706061 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m09:42:31.710690 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m09:42:31.710870 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m09:42:31.711034 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:42:32.206136 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.495 seconds
[0m09:42:32.209657 [debug] [ThreadPool]: On list_dev: Close
[0m09:42:32.327355 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m09:42:32.341170 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:42:32.342898 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:42:32.344046 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:42:32.691184 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.347 seconds
[0m09:42:32.695019 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:42:32.815298 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_analytics)
[0m09:42:32.819610 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:42:32.820288 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:42:32.820846 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:42:33.262193 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.441 seconds
[0m09:42:33.265618 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:42:33.394188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '958f9588-39de-4023-ab90-54de4f0a102a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84cf8cb0>]}
[0m09:42:33.395561 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:42:33.397033 [info ] [MainThread]: 
[0m09:42:33.409263 [debug] [Thread-1 (]: Began running node model.build_lab2.price90days_all_symbols
[0m09:42:33.410164 [info ] [Thread-1 (]: 1 of 2 START sql view model analytics.price90days_all_symbols .................. [RUN]
[0m09:42:33.411160 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_lab2.price90days_all_symbols)
[0m09:42:33.411597 [debug] [Thread-1 (]: Began compiling node model.build_lab2.price90days_all_symbols
[0m09:42:33.418119 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.price90days_all_symbols"
[0m09:42:33.419638 [debug] [Thread-1 (]: Began executing node model.build_lab2.price90days_all_symbols
[0m09:42:33.437029 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.price90days_all_symbols"
[0m09:42:33.438048 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.price90days_all_symbols"
[0m09:42:33.438353 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.price90days_all_symbols"} */
create or replace   view dev.analytics.price90days_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m09:42:33.438614 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:42:34.233256 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.794 seconds
[0m09:42:34.258104 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: Close
[0m09:42:34.368198 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '958f9588-39de-4023-ab90-54de4f0a102a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84cbcb30>]}
[0m09:42:34.369723 [info ] [Thread-1 (]: 1 of 2 OK created sql view model analytics.price90days_all_symbols ............. [[32mSUCCESS 1[0m in 0.96s]
[0m09:42:34.371381 [debug] [Thread-1 (]: Finished running node model.build_lab2.price90days_all_symbols
[0m09:42:34.372807 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m09:42:34.373686 [info ] [Thread-1 (]: 2 of 2 START sql table model analytics.stock_price_analysis .................... [RUN]
[0m09:42:34.374612 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.price90days_all_symbols, now model.build_lab2.stock_price_analysis)
[0m09:42:34.375119 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m09:42:34.381710 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m09:42:34.383539 [debug] [Thread-1 (]: Began executing node model.build_lab2.stock_price_analysis
[0m09:42:34.399287 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.stock_price_analysis"
[0m09:42:34.401491 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.stock_price_analysis"
[0m09:42:34.401914 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.stock_price_analysis"} */
create or replace transient table dev.analytics.stock_price_analysis
         as
        (

WITH staged_data AS (
    SELECT *
    FROM dev.analytics.price90days_all_symbols
),

-- 50-day Moving Average
moving_averages AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (
            PARTITION BY symbol 
            ORDER BY date 
            ROWS BETWEEN 49 PRECEDING AND CURRENT ROW
        ) AS ma_50
    FROM staged_data
),

-- 14-day RSI
price_changes AS (
    SELECT
        date,
        symbol,
        close,
        LAG(close) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        COALESCE(close - LAG(close) OVER (PARTITION BY symbol ORDER BY date), 0) AS price_change
    FROM staged_data
),
gains_and_losses AS (
    SELECT
        date,
        symbol,
        close,
        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,
        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss
    FROM price_changes
),
average_gain_loss AS (
    SELECT
        date,
        symbol,
        close,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM gains_and_losses
),
rsi_14_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0)))) AS rsi_14
    FROM average_gain_loss
    JOIN moving_averages USING (date, symbol, close)
),

-- 10-day Momentum
momentum_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        rsi_14,
        LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date) AS price_10_days_ago,
        ((close - LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date)) / 
        NULLIF(LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date), 0)) * 100 AS momentum_10
    FROM rsi_14_calculation
)

SELECT
    date,
    symbol,
    close,
    ma_50,
    rsi_14,
    momentum_10,
FROM momentum_calculation
        );
[0m09:42:34.402288 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:42:36.304866 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.902 seconds
[0m09:42:36.308946 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: Close
[0m09:42:36.424146 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '958f9588-39de-4023-ab90-54de4f0a102a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84073890>]}
[0m09:42:36.425955 [info ] [Thread-1 (]: 2 of 2 OK created sql table model analytics.stock_price_analysis ............... [[32mSUCCESS 1[0m in 2.05s]
[0m09:42:36.428070 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m09:42:36.430727 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:42:36.431466 [debug] [MainThread]: Connection 'model.build_lab2.stock_price_analysis' was properly closed.
[0m09:42:36.432231 [info ] [MainThread]: 
[0m09:42:36.433315 [info ] [MainThread]: Finished running 1 view model, 1 table model in 0 hours 0 minutes and 4.73 seconds (4.73s).
[0m09:42:36.434500 [debug] [MainThread]: Command end result
[0m09:42:36.464829 [info ] [MainThread]: 
[0m09:42:36.465825 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:42:36.466262 [info ] [MainThread]: 
[0m09:42:36.466573 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m09:42:36.467279 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.401253, "process_user_time": 2.31693, "process_kernel_time": 0.193581, "process_mem_max_rss": "210892", "process_in_blocks": "280", "process_out_blocks": "2774"}
[0m09:42:36.467610 [debug] [MainThread]: Command `dbt run` succeeded at 09:42:36.467559 after 5.40 seconds
[0m09:42:36.467893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5e875f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84362f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5cce300>]}
[0m09:42:36.468205 [debug] [MainThread]: Flushing usage events
[0m09:42:38.801951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac212360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac213770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac211490>]}


============================== 09:42:38.806035 | 578fcc86-4989-4351-ba1c-3bd462fde204 ==============================
[0m09:42:38.806035 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:42:38.806454 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:42:39.118620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '578fcc86-4989-4351-ba1c-3bd462fde204', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90da0ce0>]}
[0m09:42:39.134626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '578fcc86-4989-4351-ba1c-3bd462fde204', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab14f800>]}
[0m09:42:39.134952 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:42:39.166985 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:42:39.215726 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:42:39.215961 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:42:39.233377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '578fcc86-4989-4351-ba1c-3bd462fde204', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff868503e0>]}
[0m09:42:39.282250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '578fcc86-4989-4351-ba1c-3bd462fde204', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8630c4a0>]}
[0m09:42:39.282530 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m09:42:39.282963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '578fcc86-4989-4351-ba1c-3bd462fde204', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86813200>]}
[0m09:42:39.283877 [info ] [MainThread]: 
[0m09:42:39.284281 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:42:39.285979 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_analytics'
[0m09:42:39.292263 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:42:39.292463 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:42:39.292644 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:42:39.748278 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.455 seconds
[0m09:42:39.752036 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:42:39.871974 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_analytics, now list_dev_snapshot)
[0m09:42:39.877093 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:42:39.877839 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:42:39.878415 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:42:40.248496 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.370 seconds
[0m09:42:40.251663 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:42:40.460813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '578fcc86-4989-4351-ba1c-3bd462fde204', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86920890>]}
[0m09:42:40.462182 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:42:40.463324 [info ] [MainThread]: 
[0m09:42:40.475024 [debug] [Thread-1 (]: Began running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:42:40.476003 [info ] [Thread-1 (]: 1 of 1 START test not_null_stock_price_analysis_close .......................... [RUN]
[0m09:42:40.477202 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now test.build_lab2.not_null_stock_price_analysis_close.c1575213a5)
[0m09:42:40.477760 [debug] [Thread-1 (]: Began compiling node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:42:40.490465 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m09:42:40.491823 [debug] [Thread-1 (]: Began executing node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:42:40.502923 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m09:42:40.504290 [debug] [Thread-1 (]: Using snowflake connection "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m09:42:40.504572 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from dev.analytics.stock_price_analysis
where close is null



      
    ) dbt_internal_test
[0m09:42:40.504805 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:42:41.320947 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.816 seconds
[0m09:42:41.332476 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: Close
[0m09:42:41.463050 [info ] [Thread-1 (]: 1 of 1 PASS not_null_stock_price_analysis_close ................................ [[32mPASS[0m in 0.99s]
[0m09:42:41.465102 [debug] [Thread-1 (]: Finished running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:42:41.467643 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:42:41.468411 [debug] [MainThread]: Connection 'test.build_lab2.not_null_stock_price_analysis_close.c1575213a5' was properly closed.
[0m09:42:41.469045 [info ] [MainThread]: 
[0m09:42:41.470109 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.18 seconds (2.18s).
[0m09:42:41.471025 [debug] [MainThread]: Command end result
[0m09:42:41.502987 [info ] [MainThread]: 
[0m09:42:41.503582 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:42:41.503966 [info ] [MainThread]: 
[0m09:42:41.504264 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m09:42:41.504843 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.7341487, "process_user_time": 2.091364, "process_kernel_time": 0.20643, "process_mem_max_rss": "209580", "process_in_blocks": "56", "process_out_blocks": "1836"}
[0m09:42:41.505129 [debug] [MainThread]: Command `dbt test` succeeded at 09:42:41.505084 after 2.73 seconds
[0m09:42:41.505410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8653eea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabd66510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabd66720>]}
[0m09:42:41.505734 [debug] [MainThread]: Flushing usage events
[0m09:46:37.916246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac3914f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab945520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae5c0770>]}


============================== 09:46:37.919388 | 434c04e9-76b1-4b59-880e-217137982c3b ==============================
[0m09:46:37.919388 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:46:37.919980 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:46:38.261541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '434c04e9-76b1-4b59-880e-217137982c3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ffa0ce0>]}
[0m09:46:38.277448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '434c04e9-76b1-4b59-880e-217137982c3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab16cf20>]}
[0m09:46:38.277776 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:46:38.310487 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:46:38.356921 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:46:38.357267 [debug] [MainThread]: Partial parsing: updated file: build_lab2://snapshots/snapshot_stock_price_analysis.sql
[0m09:46:38.439582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '434c04e9-76b1-4b59-880e-217137982c3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6842e70>]}
[0m09:46:38.479431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '434c04e9-76b1-4b59-880e-217137982c3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff897ff650>]}
[0m09:46:38.479685 [info ] [MainThread]: Found 2 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m09:46:38.480066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '434c04e9-76b1-4b59-880e-217137982c3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff899eddc0>]}
[0m09:46:38.480808 [info ] [MainThread]: 
[0m09:46:38.481155 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:46:38.483035 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m09:46:38.487790 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m09:46:38.487971 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m09:46:38.488125 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:46:38.923996 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.436 seconds
[0m09:46:38.927176 [debug] [ThreadPool]: On list_dev: Close
[0m09:46:39.046687 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m09:46:39.060521 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:46:39.061252 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:46:39.061719 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:46:39.450830 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.389 seconds
[0m09:46:39.454531 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:46:39.598439 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_analytics, now list_dev_snapshot)
[0m09:46:39.603722 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:46:39.604476 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:46:39.604975 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:46:40.046317 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.441 seconds
[0m09:46:40.049960 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:46:40.163582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '434c04e9-76b1-4b59-880e-217137982c3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac23d190>]}
[0m09:46:40.165110 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:46:40.166691 [info ] [MainThread]: 
[0m09:46:40.179363 [debug] [Thread-1 (]: Began running node model.build_lab2.price90days_all_symbols
[0m09:46:40.180282 [info ] [Thread-1 (]: 1 of 2 START sql view model analytics.price90days_all_symbols .................. [RUN]
[0m09:46:40.181337 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.build_lab2.price90days_all_symbols)
[0m09:46:40.181823 [debug] [Thread-1 (]: Began compiling node model.build_lab2.price90days_all_symbols
[0m09:46:40.188378 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.price90days_all_symbols"
[0m09:46:40.190476 [debug] [Thread-1 (]: Began executing node model.build_lab2.price90days_all_symbols
[0m09:46:40.208169 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.price90days_all_symbols"
[0m09:46:40.209271 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.price90days_all_symbols"
[0m09:46:40.209550 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.price90days_all_symbols"} */
create or replace   view dev.analytics.price90days_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m09:46:40.209790 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:46:40.743282 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.533 seconds
[0m09:46:40.769061 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: Close
[0m09:46:40.886545 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '434c04e9-76b1-4b59-880e-217137982c3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89d50470>]}
[0m09:46:40.887151 [info ] [Thread-1 (]: 1 of 2 OK created sql view model analytics.price90days_all_symbols ............. [[32mSUCCESS 1[0m in 0.70s]
[0m09:46:40.887796 [debug] [Thread-1 (]: Finished running node model.build_lab2.price90days_all_symbols
[0m09:46:40.888421 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m09:46:40.888864 [info ] [Thread-1 (]: 2 of 2 START sql table model analytics.stock_price_analysis .................... [RUN]
[0m09:46:40.889319 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.price90days_all_symbols, now model.build_lab2.stock_price_analysis)
[0m09:46:40.889612 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m09:46:40.891605 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m09:46:40.892490 [debug] [Thread-1 (]: Began executing node model.build_lab2.stock_price_analysis
[0m09:46:40.903816 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.stock_price_analysis"
[0m09:46:40.905730 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.stock_price_analysis"
[0m09:46:40.905998 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.stock_price_analysis"} */
create or replace transient table dev.analytics.stock_price_analysis
         as
        (

WITH staged_data AS (
    SELECT *
    FROM dev.analytics.price90days_all_symbols
),

-- 50-day Moving Average
moving_averages AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (
            PARTITION BY symbol 
            ORDER BY date 
            ROWS BETWEEN 49 PRECEDING AND CURRENT ROW
        ) AS ma_50
    FROM staged_data
),

-- 14-day RSI
price_changes AS (
    SELECT
        date,
        symbol,
        close,
        LAG(close) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        COALESCE(close - LAG(close) OVER (PARTITION BY symbol ORDER BY date), 0) AS price_change
    FROM staged_data
),
gains_and_losses AS (
    SELECT
        date,
        symbol,
        close,
        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,
        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss
    FROM price_changes
),
average_gain_loss AS (
    SELECT
        date,
        symbol,
        close,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM gains_and_losses
),
rsi_14_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0)))) AS rsi_14
    FROM average_gain_loss
    JOIN moving_averages USING (date, symbol, close)
),

-- 10-day Momentum
momentum_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        rsi_14,
        LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date) AS price_10_days_ago,
        ((close - LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date)) / 
        NULLIF(LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date), 0)) * 100 AS momentum_10
    FROM rsi_14_calculation
)

SELECT
    date,
    symbol,
    close,
    ma_50,
    rsi_14,
    momentum_10,
FROM momentum_calculation
        );
[0m09:46:40.906237 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:46:42.068825 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.162 seconds
[0m09:46:42.072815 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: Close
[0m09:46:42.204440 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '434c04e9-76b1-4b59-880e-217137982c3b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88a50f20>]}
[0m09:46:42.205433 [info ] [Thread-1 (]: 2 of 2 OK created sql table model analytics.stock_price_analysis ............... [[32mSUCCESS 1[0m in 1.31s]
[0m09:46:42.206392 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m09:46:42.207726 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:46:42.208121 [debug] [MainThread]: Connection 'model.build_lab2.stock_price_analysis' was properly closed.
[0m09:46:42.208506 [info ] [MainThread]: 
[0m09:46:42.208992 [info ] [MainThread]: Finished running 1 view model, 1 table model in 0 hours 0 minutes and 3.73 seconds (3.73s).
[0m09:46:42.209868 [debug] [MainThread]: Command end result
[0m09:46:42.232745 [info ] [MainThread]: 
[0m09:46:42.233194 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:46:42.233509 [info ] [MainThread]: 
[0m09:46:42.233829 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m09:46:42.234538 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.3496823, "process_user_time": 2.261745, "process_kernel_time": 0.19515, "process_mem_max_rss": "207932", "process_out_blocks": "2774", "process_in_blocks": "0"}
[0m09:46:42.234928 [debug] [MainThread]: Command `dbt run` succeeded at 09:46:42.234853 after 4.35 seconds
[0m09:46:42.235220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaac75e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaaf270e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaaf267e0>]}
[0m09:46:42.235429 [debug] [MainThread]: Flushing usage events
[0m09:46:44.616624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a9fa0f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8abfedb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a9f8c20>]}


============================== 09:46:44.619379 | 84601b49-0f4b-4a89-a933-45ead76acba9 ==============================
[0m09:46:44.619379 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:46:44.619856 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:46:44.923666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '84601b49-0f4b-4a89-a933-45ead76acba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b2108f0>]}
[0m09:46:44.939877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '84601b49-0f4b-4a89-a933-45ead76acba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b945d90>]}
[0m09:46:44.940250 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:46:44.972194 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:46:45.016649 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:46:45.016902 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:46:45.034000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '84601b49-0f4b-4a89-a933-45ead76acba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff697a0f80>]}
[0m09:46:45.078047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '84601b49-0f4b-4a89-a933-45ead76acba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff698bcfe0>]}
[0m09:46:45.078311 [info ] [MainThread]: Found 2 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m09:46:45.078689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84601b49-0f4b-4a89-a933-45ead76acba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69235790>]}
[0m09:46:45.079334 [info ] [MainThread]: 
[0m09:46:45.079669 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:46:45.081260 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m09:46:45.087532 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:46:45.087713 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:46:45.087869 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:46:45.504261 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.416 seconds
[0m09:46:45.507660 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:46:45.622638 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_analytics)
[0m09:46:45.625338 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:46:45.625730 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:46:45.626074 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:46:46.034295 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.408 seconds
[0m09:46:46.038445 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:46:46.175453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84601b49-0f4b-4a89-a933-45ead76acba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff694b2e10>]}
[0m09:46:46.176726 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:46:46.178066 [info ] [MainThread]: 
[0m09:46:46.189645 [debug] [Thread-1 (]: Began running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:46:46.190449 [info ] [Thread-1 (]: 1 of 1 START test not_null_stock_price_analysis_close .......................... [RUN]
[0m09:46:46.191484 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now test.build_lab2.not_null_stock_price_analysis_close.c1575213a5)
[0m09:46:46.191941 [debug] [Thread-1 (]: Began compiling node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:46:46.204897 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m09:46:46.206101 [debug] [Thread-1 (]: Began executing node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:46:46.217032 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m09:46:46.218073 [debug] [Thread-1 (]: Using snowflake connection "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m09:46:46.218410 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from dev.analytics.stock_price_analysis
where close is null



      
    ) dbt_internal_test
[0m09:46:46.218690 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:46:46.879379 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.660 seconds
[0m09:46:46.891284 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: Close
[0m09:46:47.020545 [info ] [Thread-1 (]: 1 of 1 PASS not_null_stock_price_analysis_close ................................ [[32mPASS[0m in 0.83s]
[0m09:46:47.022736 [debug] [Thread-1 (]: Finished running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:46:47.025297 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:46:47.025957 [debug] [MainThread]: Connection 'test.build_lab2.not_null_stock_price_analysis_close.c1575213a5' was properly closed.
[0m09:46:47.026694 [info ] [MainThread]: 
[0m09:46:47.027507 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 1.95 seconds (1.95s).
[0m09:46:47.028480 [debug] [MainThread]: Command end result
[0m09:46:47.061481 [info ] [MainThread]: 
[0m09:46:47.062301 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:46:47.062676 [info ] [MainThread]: 
[0m09:46:47.062950 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m09:46:47.063568 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.4766612, "process_user_time": 2.061978, "process_kernel_time": 0.098046, "process_mem_max_rss": "207528", "process_out_blocks": "1836", "process_in_blocks": "0"}
[0m09:46:47.063912 [debug] [MainThread]: Command `dbt test` succeeded at 09:46:47.063834 after 2.48 seconds
[0m09:46:47.064190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8bab0b60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8bab2de0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8bab17f0>]}
[0m09:46:47.064461 [debug] [MainThread]: Flushing usage events
[0m09:46:48.490597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff829d5fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff856b5400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83e6d010>]}


============================== 09:46:48.493340 | db6b2884-0bc2-4fc5-b264-3475236e2863 ==============================
[0m09:46:48.493340 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:46:48.493788 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:46:48.820558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'db6b2884-0bc2-4fc5-b264-3475236e2863', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e7d27e0>]}
[0m09:46:48.836587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'db6b2884-0bc2-4fc5-b264-3475236e2863', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bca06e0>]}
[0m09:46:48.836925 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:46:48.868039 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:46:48.912649 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:46:48.912872 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:46:48.929881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'db6b2884-0bc2-4fc5-b264-3475236e2863', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff616f5f40>]}
[0m09:46:48.969569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'db6b2884-0bc2-4fc5-b264-3475236e2863', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6171d940>]}
[0m09:46:48.969871 [info ] [MainThread]: Found 2 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m09:46:48.970223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db6b2884-0bc2-4fc5-b264-3475236e2863', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6189b470>]}
[0m09:46:48.970931 [info ] [MainThread]: 
[0m09:46:48.971267 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:46:48.971700 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m09:46:48.976794 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m09:46:48.976964 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m09:46:48.977104 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:46:49.408646 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.431 seconds
[0m09:46:49.411637 [debug] [ThreadPool]: On list_dev: Close
[0m09:46:49.528675 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m09:46:49.539458 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:46:49.540129 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:46:49.540658 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:46:58.455045 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 8.914 seconds
[0m09:46:58.459972 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:46:58.589722 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_analytics, now list_dev_snapshot)
[0m09:46:58.594749 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:46:58.595433 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:46:58.595929 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:46:58.997075 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.401 seconds
[0m09:46:59.000450 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:46:59.126654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db6b2884-0bc2-4fc5-b264-3475236e2863', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff616f5b80>]}
[0m09:46:59.128072 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:46:59.129771 [info ] [MainThread]: 
[0m09:46:59.141948 [debug] [Thread-1 (]: Began running node snapshot.build_lab2.snapshot_session_summary
[0m09:46:59.142941 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_session_summary ........................ [RUN]
[0m09:46:59.144055 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now snapshot.build_lab2.snapshot_session_summary)
[0m09:46:59.144707 [debug] [Thread-1 (]: Began compiling node snapshot.build_lab2.snapshot_session_summary
[0m09:46:59.152321 [debug] [Thread-1 (]: Began executing node snapshot.build_lab2.snapshot_session_summary
[0m09:46:59.182096 [debug] [Thread-1 (]: Using snowflake connection "snapshot.build_lab2.snapshot_session_summary"
[0m09:46:59.182383 [debug] [Thread-1 (]: On snapshot.build_lab2.snapshot_session_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "snapshot.build_lab2.snapshot_session_summary"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_SESSION_SUMMARY"
[0m09:46:59.182653 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:46:59.579442 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.396 seconds
[0m09:46:59.618047 [debug] [Thread-1 (]: Using snowflake connection "snapshot.build_lab2.snapshot_session_summary"
[0m09:46:59.618496 [debug] [Thread-1 (]: On snapshot.build_lab2.snapshot_session_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "snapshot.build_lab2.snapshot_session_summary"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_SESSION_SUMMARY__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.analytics.stock_price_analysis

    ),

    snapshotted_data as (

        select *, 
    
        date as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_SESSION_SUMMARY"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(date as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        date as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        date as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m09:46:59.753624 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85cea-0004-2e68-0001-86f30007f9be
[0m09:46:59.754737 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 8
invalid identifier 'DATE'
[0m09:46:59.755577 [debug] [Thread-1 (]: On snapshot.build_lab2.snapshot_session_summary: Close
[0m09:46:59.861783 [debug] [Thread-1 (]: Database Error in snapshot snapshot_session_summary (snapshots/snapshot_stock_price_analysis.sql)
  000904 (42000): SQL compilation error: error line 17 at position 8
  invalid identifier 'DATE'
[0m09:46:59.864534 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db6b2884-0bc2-4fc5-b264-3475236e2863', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff613a1850>]}
[0m09:46:59.865835 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_session_summary .................... [[31mERROR[0m in 0.72s]
[0m09:46:59.867308 [debug] [Thread-1 (]: Finished running node snapshot.build_lab2.snapshot_session_summary
[0m09:46:59.869482 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:46:59.869893 [debug] [MainThread]: Connection 'snapshot.build_lab2.snapshot_session_summary' was properly closed.
[0m09:46:59.870288 [info ] [MainThread]: 
[0m09:46:59.870883 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 10.90 seconds (10.90s).
[0m09:46:59.871888 [debug] [MainThread]: Command end result
[0m09:46:59.897284 [info ] [MainThread]: 
[0m09:46:59.897739 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:46:59.897999 [info ] [MainThread]: 
[0m09:46:59.898289 [error] [MainThread]:   Database Error in snapshot snapshot_session_summary (snapshots/snapshot_stock_price_analysis.sql)
  000904 (42000): SQL compilation error: error line 17 at position 8
  invalid identifier 'DATE'
[0m09:46:59.898554 [info ] [MainThread]: 
[0m09:46:59.898758 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m09:46:59.899336 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 11.438142, "process_user_time": 2.194904, "process_kernel_time": 0.116312, "process_mem_max_rss": "206284", "process_out_blocks": "1844", "command_success": false, "process_in_blocks": "0"}
[0m09:46:59.899668 [debug] [MainThread]: Command `dbt snapshot` failed at 09:46:59.899614 after 11.44 seconds
[0m09:46:59.899929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff826090a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82c05b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82c07410>]}
[0m09:46:59.900158 [debug] [MainThread]: Flushing usage events
[0m09:47:51.426459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb11c7e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3fb22a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1931c40>]}


============================== 09:47:51.429619 | 12598ade-b959-415d-ae74-31e92cb579a4 ==============================
[0m09:47:51.429619 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:47:51.430075 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'send_anonymous_usage_stats': 'True'}
[0m09:47:51.740652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '12598ade-b959-415d-ae74-31e92cb579a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0ee5400>]}
[0m09:47:51.756757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '12598ade-b959-415d-ae74-31e92cb579a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb11c7d10>]}
[0m09:47:51.757157 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:47:51.789233 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:47:51.837011 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:47:51.837315 [debug] [MainThread]: Partial parsing: updated file: build_lab2://snapshots/snapshot_stock_price_analysis.sql
[0m09:47:51.916504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '12598ade-b959-415d-ae74-31e92cb579a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8bd9b770>]}
[0m09:47:51.954635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '12598ade-b959-415d-ae74-31e92cb579a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8bde8980>]}
[0m09:47:51.954908 [info ] [MainThread]: Found 2 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m09:47:51.955301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12598ade-b959-415d-ae74-31e92cb579a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8bd3fe90>]}
[0m09:47:51.956045 [info ] [MainThread]: 
[0m09:47:51.956378 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:47:51.958296 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m09:47:51.963131 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m09:47:51.963315 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m09:47:51.963481 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:47:52.612947 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.649 seconds
[0m09:47:52.616124 [debug] [ThreadPool]: On list_dev: Close
[0m09:47:52.743740 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m09:47:52.753892 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:47:52.754372 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:47:52.754716 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:47:53.172340 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.417 seconds
[0m09:47:53.176540 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:47:53.297812 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_analytics, now list_dev_snapshot)
[0m09:47:53.300997 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:47:53.301465 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:47:53.301823 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:47:53.699055 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.397 seconds
[0m09:47:53.700352 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:47:53.846829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '12598ade-b959-415d-ae74-31e92cb579a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8bd76480>]}
[0m09:47:53.847437 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:47:53.848052 [info ] [MainThread]: 
[0m09:47:53.854878 [debug] [Thread-1 (]: Began running node model.build_lab2.price90days_all_symbols
[0m09:47:53.855435 [info ] [Thread-1 (]: 1 of 2 START sql view model analytics.price90days_all_symbols .................. [RUN]
[0m09:47:53.856050 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now model.build_lab2.price90days_all_symbols)
[0m09:47:53.856364 [debug] [Thread-1 (]: Began compiling node model.build_lab2.price90days_all_symbols
[0m09:47:53.860612 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.price90days_all_symbols"
[0m09:47:53.861510 [debug] [Thread-1 (]: Began executing node model.build_lab2.price90days_all_symbols
[0m09:47:53.875190 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.price90days_all_symbols"
[0m09:47:53.876117 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.price90days_all_symbols"
[0m09:47:53.876361 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.price90days_all_symbols"} */
create or replace   view dev.analytics.price90days_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m09:47:53.876592 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:47:54.670887 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.794 seconds
[0m09:47:54.695984 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: Close
[0m09:47:54.824660 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12598ade-b959-415d-ae74-31e92cb579a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9038c920>]}
[0m09:47:54.826685 [info ] [Thread-1 (]: 1 of 2 OK created sql view model analytics.price90days_all_symbols ............. [[32mSUCCESS 1[0m in 0.97s]
[0m09:47:54.828439 [debug] [Thread-1 (]: Finished running node model.build_lab2.price90days_all_symbols
[0m09:47:54.830187 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m09:47:54.831054 [info ] [Thread-1 (]: 2 of 2 START sql table model analytics.stock_price_analysis .................... [RUN]
[0m09:47:54.832106 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.price90days_all_symbols, now model.build_lab2.stock_price_analysis)
[0m09:47:54.832745 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m09:47:54.837166 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m09:47:54.838946 [debug] [Thread-1 (]: Began executing node model.build_lab2.stock_price_analysis
[0m09:47:54.855080 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.stock_price_analysis"
[0m09:47:54.857313 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.stock_price_analysis"
[0m09:47:54.857667 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.stock_price_analysis"} */
create or replace transient table dev.analytics.stock_price_analysis
         as
        (

WITH staged_data AS (
    SELECT *
    FROM dev.analytics.price90days_all_symbols
),

-- 50-day Moving Average
moving_averages AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (
            PARTITION BY symbol 
            ORDER BY date 
            ROWS BETWEEN 49 PRECEDING AND CURRENT ROW
        ) AS ma_50
    FROM staged_data
),

-- 14-day RSI
price_changes AS (
    SELECT
        date,
        symbol,
        close,
        LAG(close) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        COALESCE(close - LAG(close) OVER (PARTITION BY symbol ORDER BY date), 0) AS price_change
    FROM staged_data
),
gains_and_losses AS (
    SELECT
        date,
        symbol,
        close,
        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,
        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss
    FROM price_changes
),
average_gain_loss AS (
    SELECT
        date,
        symbol,
        close,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM gains_and_losses
),
rsi_14_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0)))) AS rsi_14
    FROM average_gain_loss
    JOIN moving_averages USING (date, symbol, close)
),

-- 10-day Momentum
momentum_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        rsi_14,
        LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date) AS price_10_days_ago,
        ((close - LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date)) / 
        NULLIF(LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date), 0)) * 100 AS momentum_10
    FROM rsi_14_calculation
)

SELECT
    date,
    symbol,
    close,
    ma_50,
    rsi_14,
    momentum_10,
FROM momentum_calculation
        );
[0m09:47:54.858014 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:47:56.001214 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.143 seconds
[0m09:47:56.005108 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: Close
[0m09:47:56.127973 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '12598ade-b959-415d-ae74-31e92cb579a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b030b30>]}
[0m09:47:56.130402 [info ] [Thread-1 (]: 2 of 2 OK created sql table model analytics.stock_price_analysis ............... [[32mSUCCESS 1[0m in 1.29s]
[0m09:47:56.133045 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m09:47:56.136491 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:47:56.137941 [debug] [MainThread]: Connection 'model.build_lab2.stock_price_analysis' was properly closed.
[0m09:47:56.139277 [info ] [MainThread]: 
[0m09:47:56.140385 [info ] [MainThread]: Finished running 1 view model, 1 table model in 0 hours 0 minutes and 4.18 seconds (4.18s).
[0m09:47:56.141683 [debug] [MainThread]: Command end result
[0m09:47:56.169121 [info ] [MainThread]: 
[0m09:47:56.169572 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:47:56.169861 [info ] [MainThread]: 
[0m09:47:56.170203 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m09:47:56.170806 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.7765493, "process_user_time": 2.240146, "process_kernel_time": 0.13095, "process_mem_max_rss": "205980", "process_out_blocks": "2774", "process_in_blocks": "0"}
[0m09:47:56.171105 [debug] [MainThread]: Command `dbt run` succeeded at 09:47:56.171054 after 4.78 seconds
[0m09:47:56.171378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb1acf440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff901510a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0ee4f80>]}
[0m09:47:56.171653 [debug] [MainThread]: Flushing usage events
[0m09:47:57.732584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86d12750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89741f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86c61490>]}


============================== 09:47:57.735291 | 3e7929b6-ab0b-4840-8bac-220b545dd520 ==============================
[0m09:47:57.735291 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:47:57.735800 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:47:58.034480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3e7929b6-ab0b-4840-8bac-220b545dd520', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff878a5fa0>]}
[0m09:47:58.050463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3e7929b6-ab0b-4840-8bac-220b545dd520', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff65b2f950>]}
[0m09:47:58.050807 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:47:58.083043 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:47:58.127975 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:47:58.128219 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:47:58.145106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3e7929b6-ab0b-4840-8bac-220b545dd520', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d2ea150>]}
[0m09:47:58.189021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3e7929b6-ab0b-4840-8bac-220b545dd520', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6525c530>]}
[0m09:47:58.189298 [info ] [MainThread]: Found 2 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m09:47:58.189685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3e7929b6-ab0b-4840-8bac-220b545dd520', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff658937d0>]}
[0m09:47:58.190363 [info ] [MainThread]: 
[0m09:47:58.190759 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:47:58.192380 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m09:47:58.198537 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:47:58.198722 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:47:58.198851 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:47:58.588629 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.390 seconds
[0m09:47:58.591488 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:47:58.714856 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_analytics)
[0m09:47:58.718249 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:47:58.718892 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:47:58.719425 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:47:59.112173 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.392 seconds
[0m09:47:59.116170 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:47:59.230868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3e7929b6-ab0b-4840-8bac-220b545dd520', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6577a900>]}
[0m09:47:59.231947 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:47:59.233283 [info ] [MainThread]: 
[0m09:47:59.244865 [debug] [Thread-1 (]: Began running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:47:59.245642 [info ] [Thread-1 (]: 1 of 1 START test not_null_stock_price_analysis_close .......................... [RUN]
[0m09:47:59.246634 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now test.build_lab2.not_null_stock_price_analysis_close.c1575213a5)
[0m09:47:59.247163 [debug] [Thread-1 (]: Began compiling node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:47:59.260071 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m09:47:59.261525 [debug] [Thread-1 (]: Began executing node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:47:59.272659 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m09:47:59.273604 [debug] [Thread-1 (]: Using snowflake connection "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m09:47:59.273871 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from dev.analytics.stock_price_analysis
where close is null



      
    ) dbt_internal_test
[0m09:47:59.274172 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:47:59.993740 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.719 seconds
[0m09:48:00.006719 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: Close
[0m09:48:00.125917 [info ] [Thread-1 (]: 1 of 1 PASS not_null_stock_price_analysis_close ................................ [[32mPASS[0m in 0.88s]
[0m09:48:00.126935 [debug] [Thread-1 (]: Finished running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:48:00.128206 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:48:00.128545 [debug] [MainThread]: Connection 'test.build_lab2.not_null_stock_price_analysis_close.c1575213a5' was properly closed.
[0m09:48:00.128939 [info ] [MainThread]: 
[0m09:48:00.129415 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 1.94 seconds (1.94s).
[0m09:48:00.130116 [debug] [MainThread]: Command end result
[0m09:48:00.152745 [info ] [MainThread]: 
[0m09:48:00.153134 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:48:00.153378 [info ] [MainThread]: 
[0m09:48:00.153610 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m09:48:00.154162 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 2.450908, "process_user_time": 2.064187, "process_kernel_time": 0.09147, "process_mem_max_rss": "207408", "process_out_blocks": "1836", "process_in_blocks": "0"}
[0m09:48:00.154442 [debug] [MainThread]: Command `dbt test` succeeded at 09:48:00.154394 after 2.45 seconds
[0m09:48:00.154672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff654289b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86d12810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff872530e0>]}
[0m09:48:00.154925 [debug] [MainThread]: Flushing usage events
[0m09:48:02.240262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3b17e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb43a4a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5086120>]}


============================== 09:48:02.243007 | 25809f54-e9db-4ada-8331-05b9cb8a00a5 ==============================
[0m09:48:02.243007 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:48:02.243468 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:48:02.552531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '25809f54-e9db-4ada-8331-05b9cb8a00a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3920590>]}
[0m09:48:02.568689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '25809f54-e9db-4ada-8331-05b9cb8a00a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ed1dc70>]}
[0m09:48:02.569045 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:48:02.604313 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:48:02.654768 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:48:02.655276 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:48:02.678773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '25809f54-e9db-4ada-8331-05b9cb8a00a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ea299a0>]}
[0m09:48:02.719836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '25809f54-e9db-4ada-8331-05b9cb8a00a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ea28440>]}
[0m09:48:02.720127 [info ] [MainThread]: Found 2 models, 1 test, 1 snapshot, 2 sources, 459 macros
[0m09:48:02.720517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '25809f54-e9db-4ada-8331-05b9cb8a00a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e7e4d40>]}
[0m09:48:02.721204 [info ] [MainThread]: 
[0m09:48:02.721542 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:48:02.722016 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m09:48:02.727224 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m09:48:02.727393 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m09:48:02.727523 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:48:03.208983 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.481 seconds
[0m09:48:03.212029 [debug] [ThreadPool]: On list_dev: Close
[0m09:48:03.343950 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m09:48:03.355799 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:48:03.356612 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:48:03.357245 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:48:03.763728 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.406 seconds
[0m09:48:03.767956 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:48:03.895269 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_analytics, now list_dev_snapshot)
[0m09:48:03.900492 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:48:03.901404 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:48:03.902112 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:48:04.322837 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.420 seconds
[0m09:48:04.326040 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:48:04.440237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '25809f54-e9db-4ada-8331-05b9cb8a00a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8eaef5f0>]}
[0m09:48:04.441540 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:48:04.442146 [info ] [MainThread]: 
[0m09:48:04.454554 [debug] [Thread-1 (]: Began running node snapshot.build_lab2.snapshot_session_summary
[0m09:48:04.455655 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_session_summary ........................ [RUN]
[0m09:48:04.456692 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_snapshot, now snapshot.build_lab2.snapshot_session_summary)
[0m09:48:04.457314 [debug] [Thread-1 (]: Began compiling node snapshot.build_lab2.snapshot_session_summary
[0m09:48:04.464676 [debug] [Thread-1 (]: Began executing node snapshot.build_lab2.snapshot_session_summary
[0m09:48:04.494606 [debug] [Thread-1 (]: Using snowflake connection "snapshot.build_lab2.snapshot_session_summary"
[0m09:48:04.494881 [debug] [Thread-1 (]: On snapshot.build_lab2.snapshot_session_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "snapshot.build_lab2.snapshot_session_summary"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_SESSION_SUMMARY"
[0m09:48:04.495105 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:48:04.895057 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.400 seconds
[0m09:48:04.922927 [debug] [Thread-1 (]: Using snowflake connection "snapshot.build_lab2.snapshot_session_summary"
[0m09:48:04.923309 [debug] [Thread-1 (]: On snapshot.build_lab2.snapshot_session_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "snapshot.build_lab2.snapshot_session_summary"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_SESSION_SUMMARY__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.analytics.stock_price_analysis

    ),

    snapshotted_data as (

        select *, 
    
        symbol as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_SESSION_SUMMARY"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        symbol as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(symbol as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        symbol as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        symbol as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m09:48:05.038668 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85cec-0004-2e68-0001-86f30007f9ca
[0m09:48:05.039663 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 8
invalid identifier 'SYMBOL'
[0m09:48:05.040478 [debug] [Thread-1 (]: On snapshot.build_lab2.snapshot_session_summary: Close
[0m09:48:05.171743 [debug] [Thread-1 (]: Database Error in snapshot snapshot_session_summary (snapshots/snapshot_stock_price_analysis.sql)
  000904 (42000): SQL compilation error: error line 17 at position 8
  invalid identifier 'SYMBOL'
[0m09:48:05.174416 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25809f54-e9db-4ada-8331-05b9cb8a00a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd2c230>]}
[0m09:48:05.175661 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_session_summary .................... [[31mERROR[0m in 0.72s]
[0m09:48:05.177121 [debug] [Thread-1 (]: Finished running node snapshot.build_lab2.snapshot_session_summary
[0m09:48:05.179513 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:48:05.180154 [debug] [MainThread]: Connection 'snapshot.build_lab2.snapshot_session_summary' was properly closed.
[0m09:48:05.180639 [info ] [MainThread]: 
[0m09:48:05.181486 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 2.46 seconds (2.46s).
[0m09:48:05.182538 [debug] [MainThread]: Command end result
[0m09:48:05.208700 [info ] [MainThread]: 
[0m09:48:05.209217 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:48:05.209450 [info ] [MainThread]: 
[0m09:48:05.209758 [error] [MainThread]:   Database Error in snapshot snapshot_session_summary (snapshots/snapshot_stock_price_analysis.sql)
  000904 (42000): SQL compilation error: error line 17 at position 8
  invalid identifier 'SYMBOL'
[0m09:48:05.210062 [info ] [MainThread]: 
[0m09:48:05.210464 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m09:48:05.211100 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 3.000722, "process_user_time": 2.122056, "process_kernel_time": 0.111529, "process_mem_max_rss": "204488", "process_out_blocks": "1844", "command_success": false, "process_in_blocks": "0"}
[0m09:48:05.211405 [debug] [MainThread]: Command `dbt snapshot` failed at 09:48:05.211354 after 3.00 seconds
[0m09:48:05.211644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3b17e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e9f29c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e96fe60>]}
[0m09:48:05.211868 [debug] [MainThread]: Flushing usage events
[0m09:50:49.471051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7dee3fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff800e6180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f2ed730>]}


============================== 09:50:49.474110 | 5c34216a-d76e-4903-8047-df4d43a61d5d ==============================
[0m09:50:49.474110 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:50:49.474568 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:50:49.823237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c34216a-d76e-4903-8047-df4d43a61d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ea2f860>]}
[0m09:50:49.840093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c34216a-d76e-4903-8047-df4d43a61d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c3bb9b0>]}
[0m09:50:49.840493 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:50:49.875116 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:50:49.924908 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m09:50:49.925253 [debug] [MainThread]: Partial parsing: updated file: build_lab2://models/output/stock_price_analysis.sql
[0m09:50:50.045634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c34216a-d76e-4903-8047-df4d43a61d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57d70aa0>]}
[0m09:50:50.085396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c34216a-d76e-4903-8047-df4d43a61d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57578b30>]}
[0m09:50:50.085656 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m09:50:50.086034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c34216a-d76e-4903-8047-df4d43a61d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c0ed370>]}
[0m09:50:50.086786 [info ] [MainThread]: 
[0m09:50:50.087125 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:50:50.088828 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m09:50:50.093907 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m09:50:50.094087 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m09:50:50.094229 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:50:50.814487 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.720 seconds
[0m09:50:50.817720 [debug] [ThreadPool]: On list_dev: Close
[0m09:50:50.928449 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m09:50:50.938776 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:50:50.939380 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:50:50.939755 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:50:51.370660 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.431 seconds
[0m09:50:51.373626 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:50:51.513145 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_analytics)
[0m09:50:51.518049 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:50:51.518750 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:50:51.519191 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:50:51.957211 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.438 seconds
[0m09:50:51.960575 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:50:52.082311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c34216a-d76e-4903-8047-df4d43a61d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57d5b3e0>]}
[0m09:50:52.083706 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:50:52.085305 [info ] [MainThread]: 
[0m09:50:52.098502 [debug] [Thread-1 (]: Began running node model.build_lab2.price90days_all_symbols
[0m09:50:52.099473 [info ] [Thread-1 (]: 1 of 2 START sql view model analytics.price90days_all_symbols .................. [RUN]
[0m09:50:52.100434 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_lab2.price90days_all_symbols)
[0m09:50:52.100893 [debug] [Thread-1 (]: Began compiling node model.build_lab2.price90days_all_symbols
[0m09:50:52.107539 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.price90days_all_symbols"
[0m09:50:52.108839 [debug] [Thread-1 (]: Began executing node model.build_lab2.price90days_all_symbols
[0m09:50:52.126549 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.price90days_all_symbols"
[0m09:50:52.127512 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.price90days_all_symbols"
[0m09:50:52.127796 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.price90days_all_symbols"} */
create or replace   view dev.analytics.price90days_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m09:50:52.128108 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:50:52.745145 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.617 seconds
[0m09:50:52.770630 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: Close
[0m09:50:52.909223 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c34216a-d76e-4903-8047-df4d43a61d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c43c830>]}
[0m09:50:52.910795 [info ] [Thread-1 (]: 1 of 2 OK created sql view model analytics.price90days_all_symbols ............. [[32mSUCCESS 1[0m in 0.81s]
[0m09:50:52.912484 [debug] [Thread-1 (]: Finished running node model.build_lab2.price90days_all_symbols
[0m09:50:52.914103 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m09:50:52.915956 [info ] [Thread-1 (]: 2 of 2 START sql table model analytics.stock_price_analysis .................... [RUN]
[0m09:50:52.916789 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.price90days_all_symbols, now model.build_lab2.stock_price_analysis)
[0m09:50:52.917376 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m09:50:52.921365 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m09:50:52.923057 [debug] [Thread-1 (]: Began executing node model.build_lab2.stock_price_analysis
[0m09:50:52.940351 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.stock_price_analysis"
[0m09:50:52.942649 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.stock_price_analysis"
[0m09:50:52.943041 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.stock_price_analysis"} */
create or replace transient table dev.analytics.stock_price_analysis
         as
        (WITH staged_data AS (
    SELECT *
    FROM dev.analytics.price90days_all_symbols
),

-- 50-day Moving Average
moving_averages AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (
            PARTITION BY symbol 
            ORDER BY date 
            ROWS BETWEEN 49 PRECEDING AND CURRENT ROW
        ) AS ma_50
    FROM staged_data
),

-- 14-day RSI
price_changes AS (
    SELECT
        date,
        symbol,
        close,
        LAG(close) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        COALESCE(close - LAG(close) OVER (PARTITION BY symbol ORDER BY date), 0) AS price_change
    FROM staged_data
),
gains_and_losses AS (
    SELECT
        date,
        symbol,
        close,
        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,
        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss
    FROM price_changes
),
average_gain_loss AS (
    SELECT
        date,
        symbol,
        close,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM gains_and_losses
),
rsi_14_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0)))) AS rsi_14
    FROM average_gain_loss
    JOIN moving_averages USING (date, symbol, close)
),

-- 10-day Momentum
momentum_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        rsi_14,
        LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date) AS price_10_days_ago,
        ((close - LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date)) / 
        NULLIF(LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date), 0)) * 100 AS momentum_10
    FROM rsi_14_calculation
)

SELECT
    date,
    symbol,
    close,
    ma_50,
    rsi_14,
    momentum_10,
FROM momentum_calculation
        );
[0m09:50:52.943442 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:50:54.183243 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.240 seconds
[0m09:50:54.186963 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: Close
[0m09:50:54.301373 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c34216a-d76e-4903-8047-df4d43a61d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff56998350>]}
[0m09:50:54.303148 [info ] [Thread-1 (]: 2 of 2 OK created sql table model analytics.stock_price_analysis ............... [[32mSUCCESS 1[0m in 1.38s]
[0m09:50:54.304819 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m09:50:54.306920 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:50:54.307617 [debug] [MainThread]: Connection 'model.build_lab2.stock_price_analysis' was properly closed.
[0m09:50:54.308278 [info ] [MainThread]: 
[0m09:50:54.309241 [info ] [MainThread]: Finished running 1 view model, 1 table model in 0 hours 0 minutes and 4.22 seconds (4.22s).
[0m09:50:54.310286 [debug] [MainThread]: Command end result
[0m09:50:54.341398 [info ] [MainThread]: 
[0m09:50:54.342198 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:50:54.342608 [info ] [MainThread]: 
[0m09:50:54.342925 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m09:50:54.343733 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.9039636, "process_user_time": 2.355141, "process_kernel_time": 0.180857, "process_mem_max_rss": "210908", "process_out_blocks": "2773", "process_in_blocks": "0"}
[0m09:50:54.344113 [debug] [MainThread]: Command `dbt run` succeeded at 09:50:54.344058 after 4.90 seconds
[0m09:50:54.344398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d2cb9e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57962bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5c110590>]}
[0m09:50:54.344658 [debug] [MainThread]: Flushing usage events
[0m09:50:56.337489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98d2e9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98d4f0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98d8cbf0>]}


============================== 09:50:56.340221 | c220d298-3dff-4e9d-b621-1f624b99d4b2 ==============================
[0m09:50:56.340221 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:50:56.340671 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:50:56.640428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c220d298-3dff-4e9d-b621-1f624b99d4b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9870dfa0>]}
[0m09:50:56.656314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c220d298-3dff-4e9d-b621-1f624b99d4b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73cd5670>]}
[0m09:50:56.656689 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:50:56.688303 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:50:56.747711 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:50:56.747967 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:50:56.764868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c220d298-3dff-4e9d-b621-1f624b99d4b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff739d6ed0>]}
[0m09:50:56.808736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c220d298-3dff-4e9d-b621-1f624b99d4b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73859280>]}
[0m09:50:56.809033 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m09:50:56.809424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c220d298-3dff-4e9d-b621-1f624b99d4b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff73ae50d0>]}
[0m09:50:56.810070 [info ] [MainThread]: 
[0m09:50:56.810440 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:50:56.811978 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_snapshot'
[0m09:50:56.818279 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:50:56.818463 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:50:56.818602 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:50:57.973051 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 1.154 seconds
[0m09:50:57.976386 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:50:58.108194 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_analytics)
[0m09:50:58.113288 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:50:58.114146 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:50:58.114703 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:50:58.604377 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.489 seconds
[0m09:50:58.607904 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:50:58.725043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c220d298-3dff-4e9d-b621-1f624b99d4b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff739ac320>]}
[0m09:50:58.726190 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:50:58.727599 [info ] [MainThread]: 
[0m09:50:58.738759 [debug] [Thread-1 (]: Began running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:50:58.739333 [info ] [Thread-1 (]: 1 of 1 START test not_null_stock_price_analysis_close .......................... [RUN]
[0m09:50:58.740148 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now test.build_lab2.not_null_stock_price_analysis_close.c1575213a5)
[0m09:50:58.740590 [debug] [Thread-1 (]: Began compiling node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:50:58.752298 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m09:50:58.753406 [debug] [Thread-1 (]: Began executing node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:50:58.763679 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m09:50:58.764590 [debug] [Thread-1 (]: Using snowflake connection "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m09:50:58.764924 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from dev.analytics.stock_price_analysis
where close is null



      
    ) dbt_internal_test
[0m09:50:58.765189 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:50:59.351362 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.586 seconds
[0m09:50:59.355386 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: Close
[0m09:50:59.460046 [info ] [Thread-1 (]: 1 of 1 PASS not_null_stock_price_analysis_close ................................ [[32mPASS[0m in 0.72s]
[0m09:50:59.460635 [debug] [Thread-1 (]: Finished running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m09:50:59.461313 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:50:59.461522 [debug] [MainThread]: Connection 'test.build_lab2.not_null_stock_price_analysis_close.c1575213a5' was properly closed.
[0m09:50:59.461714 [info ] [MainThread]: 
[0m09:50:59.462015 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 2.65 seconds (2.65s).
[0m09:50:59.462474 [debug] [MainThread]: Command end result
[0m09:50:59.478069 [info ] [MainThread]: 
[0m09:50:59.478377 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:50:59.478569 [info ] [MainThread]: 
[0m09:50:59.478753 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m09:50:59.479190 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.171345, "process_user_time": 2.056434, "process_kernel_time": 0.095251, "process_mem_max_rss": "207540", "process_out_blocks": "1835", "process_in_blocks": "0"}
[0m09:50:59.479443 [debug] [MainThread]: Command `dbt test` succeeded at 09:50:59.479397 after 3.17 seconds
[0m09:50:59.479621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98d2e9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b8c61b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98bfb860>]}
[0m09:50:59.479783 [debug] [MainThread]: Flushing usage events
[0m09:51:01.638773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb670c9b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6edca70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6fc6180>]}


============================== 09:51:01.641499 | 56fada01-375b-443e-bf28-dcc08cf41313 ==============================
[0m09:51:01.641499 [info ] [MainThread]: Running with dbt=1.8.7
[0m09:51:01.641977 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m09:51:01.940375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '56fada01-375b-443e-bf28-dcc08cf41313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa919f620>]}
[0m09:51:01.956651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '56fada01-375b-443e-bf28-dcc08cf41313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff955bdfd0>]}
[0m09:51:01.956995 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m09:51:01.989068 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m09:51:02.034092 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:51:02.034329 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:51:02.051086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '56fada01-375b-443e-bf28-dcc08cf41313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb23ae180>]}
[0m09:51:02.089484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '56fada01-375b-443e-bf28-dcc08cf41313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9500e420>]}
[0m09:51:02.089718 [info ] [MainThread]: Found 2 models, 1 snapshot, 1 test, 2 sources, 459 macros
[0m09:51:02.090106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56fada01-375b-443e-bf28-dcc08cf41313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95301820>]}
[0m09:51:02.090879 [info ] [MainThread]: 
[0m09:51:02.091234 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m09:51:02.091697 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m09:51:02.097069 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m09:51:02.097246 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m09:51:02.097385 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:51:02.564444 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.467 seconds
[0m09:51:02.566418 [debug] [ThreadPool]: On list_dev: Close
[0m09:51:02.690003 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_snapshot)
[0m09:51:02.697197 [debug] [ThreadPool]: Using snowflake connection "list_dev_snapshot"
[0m09:51:02.697578 [debug] [ThreadPool]: On list_dev_snapshot: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_snapshot"} */
show objects in dev.snapshot limit 10000
[0m09:51:02.697911 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:51:03.188379 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.490 seconds
[0m09:51:03.191202 [debug] [ThreadPool]: On list_dev_snapshot: Close
[0m09:51:03.311929 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev_snapshot, now list_dev_analytics)
[0m09:51:03.314869 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m09:51:03.315352 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m09:51:03.315701 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:51:03.711398 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.395 seconds
[0m09:51:03.715239 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m09:51:03.845263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56fada01-375b-443e-bf28-dcc08cf41313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff953e4aa0>]}
[0m09:51:03.846609 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m09:51:03.848107 [info ] [MainThread]: 
[0m09:51:03.860175 [debug] [Thread-1 (]: Began running node snapshot.build_lab2.snapshot_session_summary
[0m09:51:03.861061 [info ] [Thread-1 (]: 1 of 1 START snapshot snapshot.snapshot_session_summary ........................ [RUN]
[0m09:51:03.862128 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now snapshot.build_lab2.snapshot_session_summary)
[0m09:51:03.862634 [debug] [Thread-1 (]: Began compiling node snapshot.build_lab2.snapshot_session_summary
[0m09:51:03.869552 [debug] [Thread-1 (]: Began executing node snapshot.build_lab2.snapshot_session_summary
[0m09:51:03.899074 [debug] [Thread-1 (]: Using snowflake connection "snapshot.build_lab2.snapshot_session_summary"
[0m09:51:03.899352 [debug] [Thread-1 (]: On snapshot.build_lab2.snapshot_session_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "snapshot.build_lab2.snapshot_session_summary"} */
describe table "DEV"."SNAPSHOT"."SNAPSHOT_SESSION_SUMMARY"
[0m09:51:03.899587 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:51:04.326571 [debug] [Thread-1 (]: SQL status: SUCCESS 8 in 0.426 seconds
[0m09:51:04.365620 [debug] [Thread-1 (]: Using snowflake connection "snapshot.build_lab2.snapshot_session_summary"
[0m09:51:04.366134 [debug] [Thread-1 (]: On snapshot.build_lab2.snapshot_session_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "snapshot.build_lab2.snapshot_session_summary"} */
create or replace temporary table "DEV"."SNAPSHOT"."SNAPSHOT_SESSION_SUMMARY__dbt_tmp"
         as
        (

    with snapshot_query as (

        

SELECT * FROM dev.analytics.stock_price_analysis

    ),

    snapshotted_data as (

        select *, 
    
        symbol as dbt_unique_key
    

        from "DEV"."SNAPSHOT"."SNAPSHOT_SESSION_SUMMARY"
        where
            
                dbt_valid_to is null
            

    ),

    insertions_source_data as (

        select *, 
    
        symbol as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            
  
  coalesce(nullif(date, date), null)
  as dbt_valid_to
,
            md5(coalesce(cast(symbol as varchar ), '')
         || '|' || coalesce(cast(date as varchar ), '')
        ) as dbt_scd_id

        from snapshot_query
    ),

    updates_source_data as (

        select *, 
    
        symbol as dbt_unique_key
    
,
            date as dbt_updated_at,
            date as dbt_valid_from,
            date as dbt_valid_to

        from snapshot_query
    ),

    deletes_source_data as (

        select *, 
    
        symbol as dbt_unique_key
    

        from snapshot_query
    ),
    

    insertions as (

        select
            'insert' as dbt_change_type,
            source_data.*

        from insertions_source_data as source_data
        left outer join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        snapshotted_data.dbt_unique_key is null
    

            or (
    
        snapshotted_data.dbt_unique_key is not null
    
 and ((snapshotted_data.dbt_valid_from < source_data.date))

        )

    ),

    updates as (

        select
            'update' as dbt_change_type,
            source_data.*,
            snapshotted_data.dbt_scd_id

        from updates_source_data as source_data
        join snapshotted_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

        where (
            (snapshotted_data.dbt_valid_from < source_data.date)
        )
    ),

    deletes as (

        select
            'delete' as dbt_change_type,
            source_data.*,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_from,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_updated_at,
            to_timestamp_ntz(convert_timezone('UTC', current_timestamp())) as dbt_valid_to,
            snapshotted_data.dbt_scd_id

        from snapshotted_data
        left join deletes_source_data as source_data
            on 
    
        snapshotted_data.dbt_unique_key = source_data.dbt_unique_key
    

            where 
    
        source_data.dbt_unique_key is null
    

    )

    select * from insertions
    union all
    select * from updates
    union all
    select * from deletes

        );
[0m09:51:04.501224 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85cef-0004-2f56-0001-86f300080526
[0m09:51:04.502170 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 8
invalid identifier 'SYMBOL'
[0m09:51:04.502996 [debug] [Thread-1 (]: On snapshot.build_lab2.snapshot_session_summary: Close
[0m09:51:04.646912 [debug] [Thread-1 (]: Database Error in snapshot snapshot_session_summary (snapshots/snapshot_stock_price_analysis.sql)
  000904 (42000): SQL compilation error: error line 17 at position 8
  invalid identifier 'SYMBOL'
[0m09:51:04.649458 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56fada01-375b-443e-bf28-dcc08cf41313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94f1f7d0>]}
[0m09:51:04.650822 [error] [Thread-1 (]: 1 of 1 ERROR snapshotting snapshot.snapshot_session_summary .................... [[31mERROR[0m in 0.79s]
[0m09:51:04.652376 [debug] [Thread-1 (]: Finished running node snapshot.build_lab2.snapshot_session_summary
[0m09:51:04.654875 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:51:04.655476 [debug] [MainThread]: Connection 'snapshot.build_lab2.snapshot_session_summary' was properly closed.
[0m09:51:04.656006 [info ] [MainThread]: 
[0m09:51:04.656848 [info ] [MainThread]: Finished running 1 snapshot in 0 hours 0 minutes and 2.56 seconds (2.56s).
[0m09:51:04.658035 [debug] [MainThread]: Command end result
[0m09:51:04.685463 [info ] [MainThread]: 
[0m09:51:04.685937 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m09:51:04.686289 [info ] [MainThread]: 
[0m09:51:04.686579 [error] [MainThread]:   Database Error in snapshot snapshot_session_summary (snapshots/snapshot_stock_price_analysis.sql)
  000904 (42000): SQL compilation error: error line 17 at position 8
  invalid identifier 'SYMBOL'
[0m09:51:04.686806 [info ] [MainThread]: 
[0m09:51:04.687042 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m09:51:04.687566 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_wall_clock_time": 3.0783734, "process_user_time": 2.144415, "process_kernel_time": 0.100253, "process_mem_max_rss": "208304", "process_out_blocks": "1843", "command_success": false, "process_in_blocks": "0"}
[0m09:51:04.687852 [debug] [MainThread]: Command `dbt snapshot` failed at 09:51:04.687805 after 3.08 seconds
[0m09:51:04.688113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb652a300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb63f3530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb63f0bf0>]}
[0m09:51:04.688347 [debug] [MainThread]: Flushing usage events
[0m10:00:03.172374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa464a270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa464a180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa464a0f0>]}


============================== 10:00:03.175585 | 595b52ba-24b4-4840-82e9-099e492ac82e ==============================
[0m10:00:03.175585 [info ] [MainThread]: Running with dbt=1.8.7
[0m10:00:03.176092 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:00:03.519864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '595b52ba-24b4-4840-82e9-099e492ac82e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f4eaff0>]}
[0m10:00:03.535739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '595b52ba-24b4-4840-82e9-099e492ac82e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f9bd580>]}
[0m10:00:03.536098 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:00:03.576764 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m10:00:03.622810 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading build_lab2: transaction_items_snapshot.yml - Runtime Error
    Syntax error near line 4
    ------------------------------
    1  | snapshots:
    2  |  - name: stock_price_snapshots
    3  |  - relation: source('stock_price_analysis')
    4  |  config:
    5  |   schema: snapshot
    6  |   unique_key:
    7  |     - symbol
    
    Raw Error:
    ------------------------------
    while parsing a block collection
      in "<unicode string>", line 2, column 2
    did not find expected '-' indicator
      in "<unicode string>", line 4, column 2
[0m10:00:03.623575 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.48256508, "process_user_time": 1.829546, "process_kernel_time": 0.115358, "process_mem_max_rss": "194872", "process_out_blocks": "5", "command_success": false, "process_in_blocks": "0"}
[0m10:00:03.623943 [debug] [MainThread]: Command `dbt run` failed at 10:00:03.623892 after 0.48 seconds
[0m10:00:03.624211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa8b9a9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa555e360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f4b12e0>]}
[0m10:00:03.624508 [debug] [MainThread]: Flushing usage events
[0m10:02:54.589197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90cdebd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92409700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff904cddf0>]}


============================== 10:02:54.591933 | 22e09dbd-a634-493a-a3ca-9306617d5b0a ==============================
[0m10:02:54.591933 [info ] [MainThread]: Running with dbt=1.8.7
[0m10:02:54.592390 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:02:54.894244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '22e09dbd-a634-493a-a3ca-9306617d5b0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b677620>]}
[0m10:02:54.910039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '22e09dbd-a634-493a-a3ca-9306617d5b0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff75776030>]}
[0m10:02:54.910343 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:02:54.945988 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m10:02:54.994673 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m10:02:54.995003 [debug] [MainThread]: Partial parsing: added file: build_lab2://snapshots/transaction_items_snapshot.yml
[0m10:02:54.995266 [debug] [MainThread]: Partial parsing: updated file: build_lab2://snapshots/snapshot_stock_price_analysis.sql
[0m10:02:55.008894 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'stock_price_snapshots' in the 'snapshots' section of file 'snapshots/transaction_items_snapshot.yml'
[0m10:02:55.036647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '22e09dbd-a634-493a-a3ca-9306617d5b0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b266000>]}
[0m10:02:55.072434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '22e09dbd-a634-493a-a3ca-9306617d5b0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b049dc0>]}
[0m10:02:55.072684 [info ] [MainThread]: Found 2 models, 1 test, 2 sources, 459 macros
[0m10:02:55.073009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '22e09dbd-a634-493a-a3ca-9306617d5b0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6af83cb0>]}
[0m10:02:55.073686 [info ] [MainThread]: 
[0m10:02:55.074027 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:02:55.075614 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m10:02:55.080207 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m10:02:55.080384 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m10:02:55.080514 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:02:55.523615 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.443 seconds
[0m10:02:55.526631 [debug] [ThreadPool]: On list_dev: Close
[0m10:02:55.677547 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m10:02:55.685949 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m10:02:55.686367 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m10:02:55.686779 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:02:56.119053 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.432 seconds
[0m10:02:56.122795 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m10:02:56.252029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '22e09dbd-a634-493a-a3ca-9306617d5b0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ae85010>]}
[0m10:02:56.253401 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:02:56.254951 [info ] [MainThread]: 
[0m10:02:56.265953 [debug] [Thread-1 (]: Began running node model.build_lab2.price90days_all_symbols
[0m10:02:56.266734 [info ] [Thread-1 (]: 1 of 2 START sql view model analytics.price90days_all_symbols .................. [RUN]
[0m10:02:56.267650 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_lab2.price90days_all_symbols)
[0m10:02:56.268111 [debug] [Thread-1 (]: Began compiling node model.build_lab2.price90days_all_symbols
[0m10:02:56.274423 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.price90days_all_symbols"
[0m10:02:56.275760 [debug] [Thread-1 (]: Began executing node model.build_lab2.price90days_all_symbols
[0m10:02:56.294099 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.price90days_all_symbols"
[0m10:02:56.295074 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.price90days_all_symbols"
[0m10:02:56.295366 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.price90days_all_symbols"} */
create or replace   view dev.analytics.price90days_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m10:02:56.295621 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:02:56.836848 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.541 seconds
[0m10:02:56.859222 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: Close
[0m10:02:56.962298 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22e09dbd-a634-493a-a3ca-9306617d5b0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6af3d820>]}
[0m10:02:56.963109 [info ] [Thread-1 (]: 1 of 2 OK created sql view model analytics.price90days_all_symbols ............. [[32mSUCCESS 1[0m in 0.69s]
[0m10:02:56.963943 [debug] [Thread-1 (]: Finished running node model.build_lab2.price90days_all_symbols
[0m10:02:56.964787 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m10:02:56.965222 [info ] [Thread-1 (]: 2 of 2 START sql table model analytics.stock_price_analysis .................... [RUN]
[0m10:02:56.965793 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.price90days_all_symbols, now model.build_lab2.stock_price_analysis)
[0m10:02:56.966133 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m10:02:56.968303 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m10:02:56.969508 [debug] [Thread-1 (]: Began executing node model.build_lab2.stock_price_analysis
[0m10:02:56.982210 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.stock_price_analysis"
[0m10:02:56.984220 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.stock_price_analysis"
[0m10:02:56.984545 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.stock_price_analysis"} */
create or replace transient table dev.analytics.stock_price_analysis
         as
        (WITH staged_data AS (
    SELECT *
    FROM dev.analytics.price90days_all_symbols
),

-- 50-day Moving Average
moving_averages AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (
            PARTITION BY symbol 
            ORDER BY date 
            ROWS BETWEEN 49 PRECEDING AND CURRENT ROW
        ) AS ma_50
    FROM staged_data
),

-- 14-day RSI
price_changes AS (
    SELECT
        date,
        symbol,
        close,
        LAG(close) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        COALESCE(close - LAG(close) OVER (PARTITION BY symbol ORDER BY date), 0) AS price_change
    FROM staged_data
),
gains_and_losses AS (
    SELECT
        date,
        symbol,
        close,
        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,
        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss
    FROM price_changes
),
average_gain_loss AS (
    SELECT
        date,
        symbol,
        close,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM gains_and_losses
),
rsi_14_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0)))) AS rsi_14
    FROM average_gain_loss
    JOIN moving_averages USING (date, symbol, close)
),

-- 10-day Momentum
momentum_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        rsi_14,
        LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date) AS price_10_days_ago,
        ((close - LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date)) / 
        NULLIF(LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date), 0)) * 100 AS momentum_10
    FROM rsi_14_calculation
)

SELECT
    date,
    symbol,
    close,
    ma_50,
    rsi_14,
    momentum_10,
FROM momentum_calculation
        );
[0m10:02:56.984889 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:02:58.781070 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.796 seconds
[0m10:02:58.784551 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: Close
[0m10:02:58.908429 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22e09dbd-a634-493a-a3ca-9306617d5b0a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6ad56c90>]}
[0m10:02:58.909352 [info ] [Thread-1 (]: 2 of 2 OK created sql table model analytics.stock_price_analysis ............... [[32mSUCCESS 1[0m in 1.94s]
[0m10:02:58.910263 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m10:02:58.911583 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:02:58.911973 [debug] [MainThread]: Connection 'model.build_lab2.stock_price_analysis' was properly closed.
[0m10:02:58.912343 [info ] [MainThread]: 
[0m10:02:58.912811 [info ] [MainThread]: Finished running 1 view model, 1 table model in 0 hours 0 minutes and 3.84 seconds (3.84s).
[0m10:02:58.913703 [debug] [MainThread]: Command end result
[0m10:02:58.937229 [info ] [MainThread]: 
[0m10:02:58.937632 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:02:58.937870 [info ] [MainThread]: 
[0m10:02:58.938088 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m10:02:58.938593 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.3796167, "process_user_time": 2.14105, "process_kernel_time": 0.116437, "process_mem_max_rss": "204172", "process_out_blocks": "2759", "process_in_blocks": "0"}
[0m10:02:58.938850 [debug] [MainThread]: Command `dbt run` succeeded at 10:02:58.938808 after 4.38 seconds
[0m10:02:58.939047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90c545c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b021880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6b020b00>]}
[0m10:02:58.939263 [debug] [MainThread]: Flushing usage events
[0m10:03:01.047109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84a2f320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff888c2840>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86809970>]}


============================== 10:03:01.049761 | b1cbe9d5-fd7f-4f79-ba91-a71b9ee76198 ==============================
[0m10:03:01.049761 [info ] [MainThread]: Running with dbt=1.8.7
[0m10:03:01.050225 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:03:01.351393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b1cbe9d5-fd7f-4f79-ba91-a71b9ee76198', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f81e990>]}
[0m10:03:01.367195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b1cbe9d5-fd7f-4f79-ba91-a71b9ee76198', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68fc3080>]}
[0m10:03:01.367519 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:03:01.400012 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m10:03:01.441988 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:03:01.442250 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:03:01.455757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b1cbe9d5-fd7f-4f79-ba91-a71b9ee76198', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f89e8d0>]}
[0m10:03:01.496284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b1cbe9d5-fd7f-4f79-ba91-a71b9ee76198', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f00d220>]}
[0m10:03:01.496555 [info ] [MainThread]: Found 2 models, 1 test, 2 sources, 459 macros
[0m10:03:01.496960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1cbe9d5-fd7f-4f79-ba91-a71b9ee76198', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f2edd60>]}
[0m10:03:01.497636 [info ] [MainThread]: 
[0m10:03:01.498006 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:03:01.499538 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_analytics'
[0m10:03:01.505439 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m10:03:01.505633 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m10:03:01.505798 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:03:01.976065 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.470 seconds
[0m10:03:01.977960 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m10:03:02.103090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1cbe9d5-fd7f-4f79-ba91-a71b9ee76198', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5f2ec470>]}
[0m10:03:02.104338 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:03:02.105679 [info ] [MainThread]: 
[0m10:03:02.116636 [debug] [Thread-1 (]: Began running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m10:03:02.117334 [info ] [Thread-1 (]: 1 of 1 START test not_null_stock_price_analysis_close .......................... [RUN]
[0m10:03:02.118300 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now test.build_lab2.not_null_stock_price_analysis_close.c1575213a5)
[0m10:03:02.118797 [debug] [Thread-1 (]: Began compiling node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m10:03:02.131598 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m10:03:02.132891 [debug] [Thread-1 (]: Began executing node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m10:03:02.144754 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m10:03:02.145813 [debug] [Thread-1 (]: Using snowflake connection "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m10:03:02.146130 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from dev.analytics.stock_price_analysis
where close is null



      
    ) dbt_internal_test
[0m10:03:02.146417 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:03:02.804841 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.658 seconds
[0m10:03:02.818022 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: Close
[0m10:03:02.937286 [info ] [Thread-1 (]: 1 of 1 PASS not_null_stock_price_analysis_close ................................ [[32mPASS[0m in 0.82s]
[0m10:03:02.939218 [debug] [Thread-1 (]: Finished running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m10:03:02.941217 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:03:02.941796 [debug] [MainThread]: Connection 'test.build_lab2.not_null_stock_price_analysis_close.c1575213a5' was properly closed.
[0m10:03:02.942298 [info ] [MainThread]: 
[0m10:03:02.943138 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 1.44 seconds (1.44s).
[0m10:03:02.944247 [debug] [MainThread]: Command end result
[0m10:03:02.973601 [info ] [MainThread]: 
[0m10:03:02.974237 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:03:02.974460 [info ] [MainThread]: 
[0m10:03:02.974712 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:03:02.975278 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 1.9580554, "process_user_time": 1.997757, "process_kernel_time": 0.083947, "process_mem_max_rss": "207008", "process_out_blocks": "1822", "process_in_blocks": "0"}
[0m10:03:02.975563 [debug] [MainThread]: Command `dbt test` succeeded at 10:03:02.975515 after 1.96 seconds
[0m10:03:02.975849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff847fa000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84aaa5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85ceff80>]}
[0m10:03:02.976183 [debug] [MainThread]: Flushing usage events
[0m10:03:04.565794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c4dfb30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e7f1370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c2b98e0>]}


============================== 10:03:04.568467 | e4aa9132-231e-4317-a130-ecf3aaccf6f9 ==============================
[0m10:03:04.568467 [info ] [MainThread]: Running with dbt=1.8.7
[0m10:03:04.568932 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:03:04.877677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e4aa9132-231e-4317-a130-ecf3aaccf6f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff76cb01d0>]}
[0m10:03:04.893836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e4aa9132-231e-4317-a130-ecf3aaccf6f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff76a2ef90>]}
[0m10:03:04.894171 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:03:04.926345 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m10:03:04.966074 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:03:04.966313 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:03:04.980141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e4aa9132-231e-4317-a130-ecf3aaccf6f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff769a4da0>]}
[0m10:03:05.016452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e4aa9132-231e-4317-a130-ecf3aaccf6f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff765b7350>]}
[0m10:03:05.016718 [info ] [MainThread]: Found 2 models, 1 test, 2 sources, 459 macros
[0m10:03:05.017117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e4aa9132-231e-4317-a130-ecf3aaccf6f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b78cf50>]}
[0m10:03:05.017794 [info ] [MainThread]: 
[0m10:03:05.018081 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m10:03:05.018868 [debug] [MainThread]: Command end result
[0m10:03:05.030944 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 0.49922788, "process_user_time": 1.851789, "process_kernel_time": 0.069178, "process_mem_max_rss": "197836", "process_out_blocks": "1805", "process_in_blocks": "0"}
[0m10:03:05.031205 [debug] [MainThread]: Command `dbt snapshot` succeeded at 10:03:05.031165 after 0.50 seconds
[0m10:03:05.031400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9bb03890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7658ff80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c2bbce0>]}
[0m10:03:05.031622 [debug] [MainThread]: Flushing usage events
[0m10:03:31.776185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8abe0170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b1422a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8df47290>]}


============================== 10:03:31.778915 | 829bd3bd-a5ab-4616-98b2-ad9b890512dc ==============================
[0m10:03:31.778915 [info ] [MainThread]: Running with dbt=1.8.7
[0m10:03:31.779383 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt/logs', 'profiles_dir': '/opt/airflow/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:03:32.087176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '829bd3bd-a5ab-4616-98b2-ad9b890512dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69cd87d0>]}
[0m10:03:32.103491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '829bd3bd-a5ab-4616-98b2-ad9b890512dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff692696a0>]}
[0m10:03:32.103840 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:03:32.135743 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m10:03:32.177405 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:03:32.177638 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:03:32.191174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '829bd3bd-a5ab-4616-98b2-ad9b890512dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff69269130>]}
[0m10:03:32.226916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '829bd3bd-a5ab-4616-98b2-ad9b890512dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff68e7c050>]}
[0m10:03:32.227164 [info ] [MainThread]: Found 2 models, 1 test, 2 sources, 459 macros
[0m10:03:32.227488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '829bd3bd-a5ab-4616-98b2-ad9b890512dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a179610>]}
[0m10:03:32.228151 [info ] [MainThread]: 
[0m10:03:32.228468 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:03:32.230093 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m10:03:32.235546 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m10:03:32.235741 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m10:03:32.235920 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:03:32.707528 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.471 seconds
[0m10:03:32.710641 [debug] [ThreadPool]: On list_dev: Close
[0m10:03:32.836359 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m10:03:32.847854 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m10:03:32.848545 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m10:03:32.848957 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:03:33.360196 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.511 seconds
[0m10:03:33.363756 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m10:03:33.491529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '829bd3bd-a5ab-4616-98b2-ad9b890512dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6a179610>]}
[0m10:03:33.492893 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:03:33.494262 [info ] [MainThread]: 
[0m10:03:33.505621 [debug] [Thread-1 (]: Began running node model.build_lab2.price90days_all_symbols
[0m10:03:33.506575 [info ] [Thread-1 (]: 1 of 2 START sql view model analytics.price90days_all_symbols .................. [RUN]
[0m10:03:33.507609 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_lab2.price90days_all_symbols)
[0m10:03:33.508049 [debug] [Thread-1 (]: Began compiling node model.build_lab2.price90days_all_symbols
[0m10:03:33.514435 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.price90days_all_symbols"
[0m10:03:33.515615 [debug] [Thread-1 (]: Began executing node model.build_lab2.price90days_all_symbols
[0m10:03:33.532715 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.price90days_all_symbols"
[0m10:03:33.533599 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.price90days_all_symbols"
[0m10:03:33.533876 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.price90days_all_symbols"} */
create or replace   view dev.analytics.price90days_all_symbols
  
   as (
    SELECT *
FROM dev.raw_data.time_series_daily
WHERE close IS NOT NULL
  );
[0m10:03:33.534135 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:03:34.209559 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.675 seconds
[0m10:03:34.237045 [debug] [Thread-1 (]: On model.build_lab2.price90days_all_symbols: Close
[0m10:03:34.369567 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '829bd3bd-a5ab-4616-98b2-ad9b890512dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ab561b0>]}
[0m10:03:34.371041 [info ] [Thread-1 (]: 1 of 2 OK created sql view model analytics.price90days_all_symbols ............. [[32mSUCCESS 1[0m in 0.86s]
[0m10:03:34.372613 [debug] [Thread-1 (]: Finished running node model.build_lab2.price90days_all_symbols
[0m10:03:34.374101 [debug] [Thread-1 (]: Began running node model.build_lab2.stock_price_analysis
[0m10:03:34.374811 [info ] [Thread-1 (]: 2 of 2 START sql table model analytics.stock_price_analysis .................... [RUN]
[0m10:03:34.375775 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_lab2.price90days_all_symbols, now model.build_lab2.stock_price_analysis)
[0m10:03:34.376331 [debug] [Thread-1 (]: Began compiling node model.build_lab2.stock_price_analysis
[0m10:03:34.380048 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_lab2.stock_price_analysis"
[0m10:03:34.381893 [debug] [Thread-1 (]: Began executing node model.build_lab2.stock_price_analysis
[0m10:03:34.398900 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_lab2.stock_price_analysis"
[0m10:03:34.401265 [debug] [Thread-1 (]: Using snowflake connection "model.build_lab2.stock_price_analysis"
[0m10:03:34.401657 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "model.build_lab2.stock_price_analysis"} */
create or replace transient table dev.analytics.stock_price_analysis
         as
        (WITH staged_data AS (
    SELECT *
    FROM dev.analytics.price90days_all_symbols
),

-- 50-day Moving Average
moving_averages AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (
            PARTITION BY symbol 
            ORDER BY date 
            ROWS BETWEEN 49 PRECEDING AND CURRENT ROW
        ) AS ma_50
    FROM staged_data
),

-- 14-day RSI
price_changes AS (
    SELECT
        date,
        symbol,
        close,
        LAG(close) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        COALESCE(close - LAG(close) OVER (PARTITION BY symbol ORDER BY date), 0) AS price_change
    FROM staged_data
),
gains_and_losses AS (
    SELECT
        date,
        symbol,
        close,
        CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,
        CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss
    FROM price_changes
),
average_gain_loss AS (
    SELECT
        date,
        symbol,
        close,
        AVG(gain) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_gain,
        AVG(loss) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 13 PRECEDING AND CURRENT ROW) AS avg_loss
    FROM gains_and_losses
),
rsi_14_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0)))) AS rsi_14
    FROM average_gain_loss
    JOIN moving_averages USING (date, symbol, close)
),

-- 10-day Momentum
momentum_calculation AS (
    SELECT
        date,
        symbol,
        close,
        ma_50,
        rsi_14,
        LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date) AS price_10_days_ago,
        ((close - LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date)) / 
        NULLIF(LAG(close, 10) OVER (PARTITION BY symbol ORDER BY date), 0)) * 100 AS momentum_10
    FROM rsi_14_calculation
)

SELECT
    date,
    symbol,
    close,
    ma_50,
    rsi_14,
    momentum_10,
FROM momentum_calculation
        );
[0m10:03:34.402038 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:03:35.888648 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.486 seconds
[0m10:03:35.892236 [debug] [Thread-1 (]: On model.build_lab2.stock_price_analysis: Close
[0m10:03:36.021411 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '829bd3bd-a5ab-4616-98b2-ad9b890512dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6917aed0>]}
[0m10:03:36.022988 [info ] [Thread-1 (]: 2 of 2 OK created sql table model analytics.stock_price_analysis ............... [[32mSUCCESS 1[0m in 1.64s]
[0m10:03:36.024665 [debug] [Thread-1 (]: Finished running node model.build_lab2.stock_price_analysis
[0m10:03:36.026752 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:03:36.027263 [debug] [MainThread]: Connection 'model.build_lab2.stock_price_analysis' was properly closed.
[0m10:03:36.027747 [info ] [MainThread]: 
[0m10:03:36.028515 [info ] [MainThread]: Finished running 1 view model, 1 table model in 0 hours 0 minutes and 3.80 seconds (3.80s).
[0m10:03:36.029559 [debug] [MainThread]: Command end result
[0m10:03:36.065056 [info ] [MainThread]: 
[0m10:03:36.065588 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:03:36.065874 [info ] [MainThread]: 
[0m10:03:36.066127 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m10:03:36.066673 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.3216496, "process_user_time": 2.14395, "process_kernel_time": 0.106748, "process_mem_max_rss": "207144", "process_out_blocks": "1849", "process_in_blocks": "0"}
[0m10:03:36.067090 [debug] [MainThread]: Command `dbt run` succeeded at 10:03:36.067011 after 4.32 seconds
[0m10:03:36.067390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff691d7bc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a66bef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a669ee0>]}
[0m10:03:36.067653 [debug] [MainThread]: Flushing usage events
[0m10:03:38.441187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d9bb560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8da67b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd4a6c0>]}


============================== 10:03:38.443936 | 326f34a4-da89-4469-b0bd-beaf24f285c5 ==============================
[0m10:03:38.443936 [info ] [MainThread]: Running with dbt=1.8.7
[0m10:03:38.444385 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt test --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:03:38.739022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '326f34a4-da89-4469-b0bd-beaf24f285c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e23b290>]}
[0m10:03:38.755202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '326f34a4-da89-4469-b0bd-beaf24f285c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6d112c60>]}
[0m10:03:38.755529 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:03:38.788017 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m10:03:38.828573 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:03:38.828824 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:03:38.842672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '326f34a4-da89-4469-b0bd-beaf24f285c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c815400>]}
[0m10:03:38.882182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '326f34a4-da89-4469-b0bd-beaf24f285c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c2b1040>]}
[0m10:03:38.882455 [info ] [MainThread]: Found 2 models, 1 test, 2 sources, 459 macros
[0m10:03:38.882840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '326f34a4-da89-4469-b0bd-beaf24f285c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c481880>]}
[0m10:03:38.883517 [info ] [MainThread]: 
[0m10:03:38.883916 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:03:38.885461 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_analytics'
[0m10:03:38.891613 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m10:03:38.891800 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m10:03:38.891967 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:03:39.371632 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.479 seconds
[0m10:03:39.374905 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m10:03:39.511215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '326f34a4-da89-4469-b0bd-beaf24f285c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6c48fdd0>]}
[0m10:03:39.511765 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m10:03:39.512302 [info ] [MainThread]: 
[0m10:03:39.518099 [debug] [Thread-1 (]: Began running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m10:03:39.518593 [info ] [Thread-1 (]: 1 of 1 START test not_null_stock_price_analysis_close .......................... [RUN]
[0m10:03:39.519060 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now test.build_lab2.not_null_stock_price_analysis_close.c1575213a5)
[0m10:03:39.519360 [debug] [Thread-1 (]: Began compiling node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m10:03:39.527907 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m10:03:39.528720 [debug] [Thread-1 (]: Began executing node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m10:03:39.537895 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m10:03:39.538656 [debug] [Thread-1 (]: Using snowflake connection "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"
[0m10:03:39.538908 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_lab2", "target_name": "dev", "node_id": "test.build_lab2.not_null_stock_price_analysis_close.c1575213a5"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from dev.analytics.stock_price_analysis
where close is null



      
    ) dbt_internal_test
[0m10:03:39.539121 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:03:40.144961 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.606 seconds
[0m10:03:40.155490 [debug] [Thread-1 (]: On test.build_lab2.not_null_stock_price_analysis_close.c1575213a5: Close
[0m10:03:40.296108 [info ] [Thread-1 (]: 1 of 1 PASS not_null_stock_price_analysis_close ................................ [[32mPASS[0m in 0.78s]
[0m10:03:40.298172 [debug] [Thread-1 (]: Finished running node test.build_lab2.not_null_stock_price_analysis_close.c1575213a5
[0m10:03:40.300334 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:03:40.300997 [debug] [MainThread]: Connection 'test.build_lab2.not_null_stock_price_analysis_close.c1575213a5' was properly closed.
[0m10:03:40.301769 [info ] [MainThread]: 
[0m10:03:40.302605 [info ] [MainThread]: Finished running 1 test in 0 hours 0 minutes and 1.42 seconds (1.42s).
[0m10:03:40.303520 [debug] [MainThread]: Command end result
[0m10:03:40.334566 [info ] [MainThread]: 
[0m10:03:40.335361 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:03:40.335665 [info ] [MainThread]: 
[0m10:03:40.335955 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:03:40.336714 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 1.9254125, "process_user_time": 1.987367, "process_kernel_time": 0.080974, "process_mem_max_rss": "208944", "process_out_blocks": "1822", "process_in_blocks": "0"}
[0m10:03:40.337092 [debug] [MainThread]: Command `dbt test` succeeded at 10:03:40.337035 after 1.93 seconds
[0m10:03:40.337353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e9a53a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd1a870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6cb403e0>]}
[0m10:03:40.337625 [debug] [MainThread]: Flushing usage events
[0m10:03:41.748822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81644860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82c3b980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81454a70>]}


============================== 10:03:41.751539 | c768d245-51f0-4db9-af32-866a556c837b ==============================
[0m10:03:41.751539 [info ] [MainThread]: Running with dbt=1.8.7
[0m10:03:41.752017 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt', 'log_path': '/opt/airflow/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt snapshot --profiles-dir /opt/airflow/dbt --project-dir /opt/airflow/dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:03:42.051218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c768d245-51f0-4db9-af32-866a556c837b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff61476c30>]}
[0m10:03:42.067644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c768d245-51f0-4db9-af32-866a556c837b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff77719070>]}
[0m10:03:42.068000 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m10:03:42.100632 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m10:03:42.142406 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:03:42.142635 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:03:42.156243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c768d245-51f0-4db9-af32-866a556c837b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5ba771a0>]}
[0m10:03:42.191910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c768d245-51f0-4db9-af32-866a556c837b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b7b3200>]}
[0m10:03:42.192196 [info ] [MainThread]: Found 2 models, 1 test, 2 sources, 459 macros
[0m10:03:42.192552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c768d245-51f0-4db9-af32-866a556c837b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff5b787770>]}
[0m10:03:42.193191 [info ] [MainThread]: 
[0m10:03:42.193412 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m10:03:42.194170 [debug] [MainThread]: Command end result
[0m10:03:42.205556 [debug] [MainThread]: Resource report: {"command_name": "snapshot", "command_success": true, "command_wall_clock_time": 0.48707876, "process_user_time": 1.838912, "process_kernel_time": 0.065925, "process_mem_max_rss": "199900", "process_out_blocks": "1805", "process_in_blocks": "0"}
[0m10:03:42.205830 [debug] [MainThread]: Command `dbt snapshot` succeeded at 10:03:42.205793 after 0.49 seconds
[0m10:03:42.206003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81644860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83ab5370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81429820>]}
[0m10:03:42.206179 [debug] [MainThread]: Flushing usage events
